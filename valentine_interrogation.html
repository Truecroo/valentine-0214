<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ï–°–°–ò–Ø | –û–ë–™–ï–ö–¢ ‚Ññ31</title>
    <style>
        :root { --main-color: #ff4d4d; --bg-color: #0a0a0a; --bond-color: #ff00ff; }

        * { box-sizing: border-box; }

        body { background: var(--bg-color); color: #ccc; font-family: 'Courier New', monospace; display: flex; justify-content: center; padding: 20px; margin: 0; }

        #game-window {
            display: grid; grid-template-columns: 250px 1fr; gap: 20px;
            width: 900px; height: 620px; border: 1px solid #333;
            padding: 20px; background: #111; position: relative; overflow: hidden;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        /* Heartbeat-–ø—É–ª—å—Å–∞—Ü–∏—è —Ä–∞–º–∫–∏ */
        #game-window.heartbeat-1 { animation: heartbeat 2s infinite; }
        #game-window.heartbeat-2 { animation: heartbeat 1.4s infinite; }
        #game-window.heartbeat-3 { animation: heartbeat 0.9s infinite; }
        #game-window.heartbeat-4 { animation: heartbeat 0.6s infinite; }
        @keyframes heartbeat {
            0%, 100% { border-color: #333; box-shadow: none; }
            15% { border-color: #ff0033; box-shadow: 0 0 15px rgba(255,0,51,0.3), inset 0 0 15px rgba(255,0,51,0.05); }
            30% { border-color: #550011; box-shadow: none; }
            45% { border-color: #ff0022; box-shadow: 0 0 10px rgba(255,0,34,0.2), inset 0 0 10px rgba(255,0,34,0.03); }
            60% { border-color: #333; box-shadow: none; }
        }

        /* Scanlines overlay */
        #game-window::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.08) 2px, rgba(0,0,0,0.08) 4px);
            pointer-events: none; z-index: 10;
        }

        /* REC –º–µ—Ç–∫–∞ */
        .rec-badge {
            position: absolute; top: 12px; right: 16px; z-index: 20;
            font-size: 0.7em; color: #ff0000; letter-spacing: 2px;
            display: flex; align-items: center; gap: 6px;
        }
        .rec-dot {
            width: 8px; height: 8px; border-radius: 50%; background: #ff0000;
            animation: rec-blink 1.2s infinite;
        }
        @keyframes rec-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* –ö–∞–º–µ—Ä–∞ –∏–Ω—Ñ–æ */
        .cam-info {
            position: absolute; bottom: 10px; left: 16px; z-index: 20;
            font-size: 0.6em; color: #444; letter-spacing: 1px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats { border-right: 1px solid #333; padding-right: 20px; display: flex; flex-direction: column; gap: 5px; overflow: hidden; }
        #state-image {
            width: 200px; height: 190px; background: #222; border: 2px solid #444;
            margin-bottom: 8px; overflow: hidden; position: relative;
            cursor: pointer; flex-shrink: 0;
        }
        #state-image img {
            width: 100%; height: 100%; object-fit: cover;
            transition: opacity 0.8s ease;
            transform-origin: center center;
        }
        /* –§–æ—Ç–æ ¬´–¥—ã—à–∏—Ç¬ª */
        #state-image.breathe-1 img { animation: breathe 4s ease-in-out infinite; }
        #state-image.breathe-2 img { animation: breathe 3s ease-in-out infinite; }
        #state-image.breathe-3 img { animation: breathe 2s ease-in-out infinite; }
        #state-image.breathe-4 img { animation: breathe 1.2s ease-in-out infinite; }
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.04); }
        }
        /* –†–µ–∞–∫—Ü–∏—è –Ω–∞ –∫–ª–∏–∫ –ø–æ —Ñ–æ—Ç–æ */
        #state-image.clicked img {
            animation: photo-click-flash 0.3s ease-out;
        }
        @keyframes photo-click-flash {
            0% { filter: brightness(1); }
            30% { filter: brightness(1.5); }
            100% { filter: brightness(1); }
        }
        /* –í—Å–ø–ª—ã–≤–∞—é—â–∞—è —Ñ—Ä–∞–∑–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ */
        .photo-whisper {
            position: absolute; bottom: 8px; left: 8px; right: 8px;
            background: rgba(0,0,0,0.85);
            color: var(--main-color);
            font-size: 0.65em;
            padding: 6px 8px;
            text-align: center;
            line-height: 1.3;
            z-index: 5;
            animation: whisper-appear 0.3s ease-out, whisper-fade 0.5s 2.5s forwards;
            pointer-events: none;
        }
        @keyframes whisper-appear {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes whisper-fade {
            to { opacity: 0; }
        }
        .stat-bar { background: #222; height: 10px; width: 100%; margin: 6px 0; border-radius: 5px; overflow: hidden; }
        .progress { height: 100%; width: 0%; transition: 0.5s; border-radius: 5px; }
        .progress-control { background: var(--main-color); }
        .progress-bond { background: var(--bond-color); }
        .label { font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; }

        /* === –ó–ê–ú–ï–¢–ö–ò + –ì–õ–ê–ó === */
        .psych-panel {
            margin-top: auto;
            margin-bottom: auto;
            display: flex;
            flex-direction: column;
            gap: 0;
            flex-shrink: 0;
        }

        /* –ì–ª–∞–∑ */
        .eye-monitor {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 0 4px 0;
        }
        .eye-container {
            width: 52px; height: 28px;
            position: relative;
            flex-shrink: 0;
        }
        .eye-shape {
            width: 100%; height: 100%;
            border: 2px solid #444;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: border-color 0.5s;
            background: radial-gradient(ellipse, rgba(30,30,30,0.4) 0%, transparent 70%);
        }
        .eye-pupil {
            width: 10px; height: 10px;
            background: #777;
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.8s, height 0.8s, background 0.8s, box-shadow 0.8s;
        }
        /* –£—Ä–æ–≤–Ω–∏ –∑—Ä–∞—á–∫–∞ */
        .eye-pupil.dilate-1 { width: 12px; height: 12px; background: #999; }
        .eye-pupil.dilate-2 { width: 15px; height: 15px; background: #aa5555; box-shadow: 0 0 6px rgba(170,85,85,0.4); }
        .eye-pupil.dilate-3 { width: 18px; height: 18px; background: #cc3333; box-shadow: 0 0 10px rgba(204,51,51,0.6); animation: pupil-pulse 2s ease-in-out infinite; }
        .eye-pupil.dilate-4 { width: 22px; height: 22px; background: #ff0000; box-shadow: 0 0 14px rgba(255,0,0,0.8); animation: pupil-pulse 1s ease-in-out infinite; }
        @keyframes pupil-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
        }
        /* –ú–æ—Ä–≥–∞–Ω–∏–µ */
        .eye-shape.blinking { animation: eye-blink 0.2s ease-in-out; }
        @keyframes eye-blink {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.05); }
        }
        /* –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –≥–µ–π–º-–æ–≤–µ—Ä–µ */
        .eye-shape.closing { animation: eye-close 2s forwards; }
        @keyframes eye-close { to { transform: scaleY(0); } }
        .eye-label {
            font-size: 0.7em;
            color: #555;
            line-height: 1.2;
            letter-spacing: 0.5px;
            transition: color 0.5s;
        }
        .eye-label.warn { color: #aa5555; }
        .eye-label.danger { color: #ff3333; text-shadow: 0 0 8px rgba(255,51,51,0.3); animation: label-flicker 2.5s ease-in-out infinite; }
        @keyframes label-flicker {
            0%, 100% { opacity: 1; }
            40% { opacity: 0.7; }
            50% { opacity: 1; }
            60% { opacity: 0.6; }
            70% { opacity: 1; }
        }
        .eye-shape.eye-danger {
            animation: eye-border-flicker 3s ease-in-out infinite;
        }
        @keyframes eye-border-flicker {
            0%, 100% { border-color: #ff3333; box-shadow: none; }
            30% { border-color: #ff0000; box-shadow: 0 0 8px rgba(255,0,0,0.4); }
            50% { border-color: #aa2222; box-shadow: none; }
            70% { border-color: #ff1111; box-shadow: 0 0 6px rgba(255,0,0,0.3); }
        }

        /* –ó–∞–º–µ—Ç–∫–∏ ‚Äî —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç */
        .notebook {
            padding: 0 0 6px 0;
            font-size: 0.78em;
            line-height: 1.4;
            font-style: italic;
            color: #4a4a4a;
            transition: color 1.5s, letter-spacing 1.5s;
            min-height: 20px;
            border-bottom: 1px solid #222;
            margin-bottom: 2px;
            position: relative;
            overflow: hidden;
        }
        .notebook.note-warm {
            color: #7a5555;
            letter-spacing: 0.3px;
        }
        .notebook.note-hot {
            color: #aa4444;
            letter-spacing: 0.8px;
            animation: note-tremble 4s ease-in-out infinite;
        }
        .notebook.note-critical {
            color: #ff4d4d;
            text-shadow: 0 0 6px rgba(255,77,77,0.3);
            letter-spacing: 1.2px;
            animation: note-madness 1.5s ease-in-out infinite;
        }
        .notebook.note-critical::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,0,0,0.03) 50%, transparent 100%);
            animation: note-scan 2s linear infinite;
            pointer-events: none;
        }
        @keyframes note-tremble {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-0.5px); }
            20% { transform: translateX(0.5px); }
            30% { transform: translateX(0); }
        }
        @keyframes note-madness {
            0%, 100% { transform: translateX(0) skewX(0deg); opacity: 1; }
            15% { transform: translateX(-1px) skewX(-0.3deg); }
            30% { transform: translateX(0.5px) skewX(0.2deg); opacity: 0.85; }
            50% { transform: translateX(-0.5px) skewX(0deg); }
            70% { transform: translateX(1px) skewX(-0.2deg); opacity: 0.9; }
            85% { transform: translateX(-0.3px) skewX(0.3deg); }
        }
        @keyframes note-scan {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }
        .notebook .note-change {
            animation: note-appear 0.8s ease-out;
            display: block;
        }
        @keyframes note-appear {
            0% { opacity: 0; transform: translateY(3px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        /* –°–ª–æ–≤–∞ —Ä–∞–∑—ä–µ–∑–∂–∞—é—Ç—Å—è –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —É—Ä–æ–≤–Ω–µ */
        .notebook.note-critical .note-change {
            animation: note-appear 0.8s ease-out, note-breathe 3s ease-in-out 0.8s infinite;
        }
        @keyframes note-breathe {
            0%, 100% { letter-spacing: 1.2px; word-spacing: 0; }
            50% { letter-spacing: 2px; word-spacing: 3px; }
        }

        /* –¢–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–ª–∑–∞–µ—Ç—Å—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ */
        .text-decay-1 { letter-spacing: 0.5px; }
        .text-decay-2 { letter-spacing: 1.5px; word-spacing: 3px; }
        .text-decay-3 { letter-spacing: 3px; word-spacing: 6px; }
        .text-decay-4 {
            letter-spacing: 5px; word-spacing: 10px;
            animation: text-decay-pulse 1.5s infinite;
        }
        @keyframes text-decay-pulse {
            0%, 100% { letter-spacing: 5px; }
            50% { letter-spacing: 7px; }
        }

        /* –ß–∞—Ç */
        #chat-area { display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; }
        #messages { flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #333; margin-bottom: 10px; min-height: 0; }
        .msg { margin-bottom: 12px; line-height: 1.5; font-size: 0.9em; }
        .patient { color: var(--main-color); }
        .doctor { color: #4dff88; text-align: right; }
        .scene-text { color: #666; font-style: italic; margin-bottom: 15px; line-height: 1.5; font-size: 0.85em; }
        .object-speech { color: var(--main-color); margin-bottom: 12px; line-height: 1.5; font-size: 0.9em; }
        .reaction-text { color: var(--main-color); margin-bottom: 12px; line-height: 1.5; font-size: 0.9em; }
        .system-msg { color: #444; text-align: center; font-size: 0.75em; letter-spacing: 2px; margin: 15px 0; }

        /* –ú–∏–≥–∞—é—â–∏–π –∫—É—Ä—Å–æ—Ä */
        .typing-cursor {
            display: inline-block; width: 8px; height: 14px;
            background: var(--main-color); margin-left: 2px;
            animation: cursor-blink 0.6s infinite;
            vertical-align: text-bottom;
        }
        @keyframes cursor-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button {
            background: transparent; border: 1px solid #444; color: #888;
            padding: 8px 10px; cursor: pointer; font-family: inherit; font-size: 0.82em;
            opacity: 0; transform: translateY(8px);
            animation: btn-fade-in 0.4s forwards;
            transition: border-color 0.2s, color 0.2s;
            text-align: left; line-height: 1.3;
        }
        button:nth-child(1) { animation-delay: 0.1s; }
        button:nth-child(2) { animation-delay: 0.2s; }
        button:nth-child(3) { animation-delay: 0.3s; }
        button:nth-child(4) { animation-delay: 0.4s; }
        @keyframes btn-fade-in { to { opacity: 1; transform: translateY(0); } }
        button:hover:not(:disabled) { border-color: var(--main-color); color: white; }
        button:disabled { opacity: 0.3; cursor: not-allowed; border-color: #333; color: #555; }
        button.locked { opacity: 0.25; cursor: not-allowed; border-color: #222; color: #444; font-style: italic; }
        button.locked::after { content: ' üîí'; }
        button.danger-btn { border-color: #660022; }
        button.danger-btn:hover:not(:disabled) { border-color: #ff0044; color: #ff4466; }
        button.warn-btn { border-color: #553300; }
        button.warn-btn:hover:not(:disabled) { border-color: #ffaa00; color: #ffcc44; }

        /* –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç ‚Äî —É—Ä–æ–≤–µ–Ω—å 1: –ª—ë–≥–∫–∞—è —Ç—Ä—è—Å–∫–∞ (bond >= 60) */
        .glitch-light { animation: glitch-light 0.2s infinite; }
        @keyframes glitch-light {
            0% { transform: translate(0); }
            25% { transform: translate(-1px, 0.5px); }
            50% { transform: translate(0.5px, -1px); }
            75% { transform: translate(-0.5px, -0.5px); }
            100% { transform: translate(1px, 0.5px); }
        }

        /* –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç ‚Äî —É—Ä–æ–≤–µ–Ω—å 2: –∑–∞–º–µ—Ç–Ω–∞—è —Ç—Ä—è—Å–∫–∞ (bond >= 75 –∏–ª–∏ control <= 35) */
        .glitch-text { animation: glitch-shake 0.1s infinite; }
        @keyframes glitch-shake {
            0% { transform: translate(0) skewX(0deg); }
            20% { transform: translate(-3px, 2px) skewX(-1deg); }
            40% { transform: translate(2px, -2px) skewX(1deg); }
            60% { transform: translate(-2px, -1px) skewX(-0.5deg); }
            80% { transform: translate(3px, 1px) skewX(0.5deg); }
            100% { transform: translate(-1px, 2px) skewX(0deg); }
        }

        /* –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç ‚Äî —É—Ä–æ–≤–µ–Ω—å 3: —Å–∏–ª—å–Ω–∞—è —Ç—Ä—è—Å–∫–∞ + –∏—Å–∫–∞–∂–µ–Ω–∏—è (bond >= 85 –∏–ª–∏ control <= 20) */
        .glitch-heavy { animation: glitch-heavy 0.08s infinite; }
        @keyframes glitch-heavy {
            0% { transform: translate(0) skewX(0deg) scaleY(1); }
            15% { transform: translate(-4px, 3px) skewX(-3deg) scaleY(1.02); }
            30% { transform: translate(5px, -2px) skewX(2deg) scaleY(0.98); }
            45% { transform: translate(-3px, -3px) skewX(-2deg) scaleY(1.01); }
            60% { transform: translate(4px, 2px) skewX(4deg) scaleY(0.97); }
            75% { transform: translate(-5px, 1px) skewX(-1deg) scaleY(1.03); }
            100% { transform: translate(2px, -3px) skewX(1deg) scaleY(1); }
        }

        /* –¶–≤–µ—Ç–æ–≤–æ–π —Å–¥–≤–∏–≥ */
        .glitch-color { animation: glitch-color-shift 0.15s infinite; }
        @keyframes glitch-color-shift {
            0% { color: var(--main-color); text-shadow: none; }
            20% { color: #ff00ff; text-shadow: -2px 0 #00ffff; }
            40% { color: #00ffff; text-shadow: 2px 0 #ff00ff; }
            60% { color: var(--main-color); text-shadow: -1px 1px #ff0000; }
            80% { color: #ff0044; text-shadow: 1px -1px #00ff00; }
            100% { color: var(--main-color); text-shadow: none; }
        }

        /* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –≥–ª–∏—Ç—á ‚Äî —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–∞–¥–∞–µ—Ç—Å—è */
        .glitch-critical {
            animation: glitch-critical 0.06s infinite;
            text-shadow: -3px 0 #ff0000, 3px 0 #00ffff;
        }
        @keyframes glitch-critical {
            0% { transform: translate(0) skewX(0) scaleX(1); clip-path: inset(0 0 0 0); }
            10% { transform: translate(-6px, 4px) skewX(-5deg) scaleX(1.02); }
            20% { transform: translate(5px, -3px) skewX(4deg) scaleX(0.98); clip-path: inset(20% 0 30% 0); }
            30% { transform: translate(-4px, -2px) skewX(-3deg); clip-path: inset(0 0 0 0); }
            40% { transform: translate(6px, 3px) skewX(5deg) scaleX(1.03); }
            50% { transform: translate(-3px, 4px) skewX(-2deg); clip-path: inset(40% 0 10% 0); }
            60% { transform: translate(4px, -4px) skewX(3deg) scaleX(0.97); clip-path: inset(0 0 0 0); }
            70% { transform: translate(-5px, 2px) skewX(-4deg); }
            80% { transform: translate(3px, -3px) skewX(2deg) scaleX(1.01); clip-path: inset(60% 0 5% 0); }
            90% { transform: translate(-2px, 3px) skewX(-1deg); clip-path: inset(0 0 0 0); }
            100% { transform: translate(0) skewX(0) scaleX(1); }
        }

        /* –ì–ª–∏—Ç—á-–ø–æ–ª–æ—Å–∞ */
        .glitch-bar {
            position: absolute; left: 0; right: 0; height: 3px;
            background: rgba(255, 0, 255, 0.3); z-index: 15;
            pointer-events: none; display: none;
        }
        .glitch-bar.heavy {
            height: 6px;
            background: rgba(255, 0, 255, 0.6);
        }
        .glitch-bar.critical {
            height: 10px;
            background: linear-gradient(90deg, rgba(255,0,255,0.8), rgba(0,255,255,0.5), rgba(255,0,0,0.8));
        }

        /* –í—Å–ø—ã—à–∫–∞ –ø–æ–º–µ—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–≤—è–∑–∏ */
        .screen-flash {
            position: absolute; inset: 0; z-index: 12;
            pointer-events: none; opacity: 0;
        }
        .screen-flash.active {
            animation: screen-noise-flash 0.4s ease-out;
        }
        .screen-flash.heavy-flash {
            animation: screen-noise-heavy 0.6s ease-out;
        }
        @keyframes screen-noise-flash {
            0% { opacity: 0.5; background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                rgba(255,0,255,0.1) 2px,
                transparent 4px,
                rgba(0,255,255,0.08) 6px
            ); }
            30% { opacity: 0.3; }
            100% { opacity: 0; }
        }
        @keyframes screen-noise-heavy {
            0% { opacity: 0.8; background: repeating-linear-gradient(
                0deg,
                rgba(255,0,0,0.15) 0px,
                transparent 1px,
                rgba(255,0,255,0.2) 3px,
                transparent 4px,
                rgba(0,255,255,0.15) 5px,
                transparent 7px
            ); }
            15% { opacity: 0.6; background: repeating-linear-gradient(
                0deg,
                transparent 0px,
                rgba(255,255,255,0.15) 1px,
                transparent 2px,
                rgba(255,0,0,0.2) 4px,
                transparent 5px
            ); }
            40% { opacity: 0.3; }
            100% { opacity: 0; }
        }

        /* –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —à—É–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Å–≤—è–∑–∏ */
        .noise-overlay {
            position: absolute; inset: 0; z-index: 11;
            pointer-events: none; opacity: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            mix-blend-mode: overlay;
            transition: opacity 0.5s;
        }
        .noise-overlay.level-1 { opacity: 0.03; }
        .noise-overlay.level-2 { opacity: 0.06; }
        .noise-overlay.level-3 { opacity: 0.1; animation: noise-flicker 0.1s infinite; }
        .noise-overlay.level-4 { opacity: 0.15; animation: noise-flicker 0.05s infinite; }
        @keyframes noise-flicker {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-1px, 1px); }
            100% { transform: translate(1px, -1px); }
        }

        /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞-–ø–æ–º–µ—Ö–∞ */
        .v-glitch {
            position: absolute; top: 0; bottom: 0; width: 0; z-index: 13;
            pointer-events: none; display: none;
            background: rgba(255, 0, 255, 0.15);
        }
        .v-glitch.active {
            display: block;
            animation: v-glitch-sweep 0.3s ease-out forwards;
        }
        @keyframes v-glitch-sweep {
            0% { width: 8px; opacity: 1; }
            50% { width: 15px; opacity: 0.6; }
            100% { width: 0; opacity: 0; }
        }

        /* –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã */
        .victory-reveal {
            text-align: center; padding: 30px; animation: reveal-glow 2s ease-in-out infinite alternate;
        }
        .reveal-word {
            font-size: 3em; color: var(--main-color); letter-spacing: 15px;
            text-shadow: 0 0 20px rgba(255,77,77,0.5);
            animation: reveal-pulse 1.5s ease-in-out;
        }
        @keyframes reveal-pulse {
            0% { opacity: 0; transform: scale(0.5); letter-spacing: 50px; }
            100% { opacity: 1; transform: scale(1); letter-spacing: 15px; }
        }
        @keyframes reveal-glow {
            from { text-shadow: 0 0 20px rgba(255,77,77,0.3); }
            to { text-shadow: 0 0 40px rgba(255,77,77,0.7); }
        }

        /* –ü–æ—Å—Ç-–∫—Ä–µ–¥–∏—Ç–Ω–∞—è —Å—Ü–µ–Ω–∞ */
        #post-credits {
            position: fixed; inset: 0; background: #000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50; padding: 40px; font-family: 'Courier New', monospace;
        }
        #post-credits.visible { display: flex; }
        .post-credits-text {
            max-width: 600px; color: #888; font-size: 0.9em; line-height: 1.8;
            text-align: center; animation: fade-in-slow 3s;
        }
        @keyframes fade-in-slow { from { opacity: 0; } to { opacity: 1; } }
        .post-credits-black {
            color: #333; font-size: 0.8em; margin-top: 30px;
            text-align: center; letter-spacing: 2px;
        }

        /* === –≠–ö–†–ê–ù –í–í–û–î–ê –ö–û–î–ê === */
        #code-entry {
            position: fixed; inset: 0;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            font-family: 'Courier New', monospace;
        }
        #code-entry.hidden { display: none; }

        .code-entry-scanlines {
            position: absolute; inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 4px);
            pointer-events: none;
        }
        .code-entry-content {
            position: relative; z-index: 2;
            display: flex; flex-direction: column; align-items: center;
            gap: 15px;
        }
        .code-entry-icon { font-size: 1.5em; color: #333; margin-bottom: 5px; }
        .code-entry-title {
            font-size: 0.7em; color: #555; letter-spacing: 4px;
            text-transform: uppercase; margin-bottom: 5px;
        }
        .code-entry-subtitle {
            font-size: 0.6em; color: #333; letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .code-inputs { display: flex; gap: 12px; margin-bottom: 10px; }
        .code-digit {
            width: 52px; height: 64px;
            background: transparent;
            border: 1px solid #333;
            color: #ff4d4d;
            font-family: 'Courier New', monospace;
            font-size: 2em;
            text-align: center;
            outline: none;
            caret-color: #ff4d4d;
            transition: border-color 0.3s;
        }
        .code-digit:focus { border-color: #ff4d4d; }
        .code-digit.error {
            border-color: #ff0000;
            animation: code-shake 0.4s;
        }
        .code-digit.success {
            border-color: #4dff88;
            color: #4dff88;
        }
        @keyframes code-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .code-entry-status {
            font-size: 0.65em; color: #333; letter-spacing: 1px;
            min-height: 20px;
            transition: color 0.3s;
        }
        .code-entry-status.error { color: #ff0000; }
        .code-entry-status.success { color: #4dff88; }

        .code-entry-footer {
            position: absolute; bottom: 30px;
            font-size: 0.55em; color: #222; letter-spacing: 1px;
        }

        /* –ü–µ—á–∞—Ç—å */
        @media print {
            body * { display: none !important; }
            #print-area, #print-area * { display: block !important; }
            #print-area {
                position: fixed; inset: 0;
                background: white; color: black;
                padding: 40px; font-family: 'Courier New', monospace;
            }
        }
    </style>
</head>
<body>

<!-- –≠–ö–†–ê–ù –í–í–û–î–ê –ö–û–î–ê -->
<div id="code-entry">
    <div class="code-entry-scanlines"></div>
    <div class="code-entry-content">
        <div class="code-entry-icon">&#9608;&#9608;&#9608;</div>
        <div class="code-entry-title">–¢–µ—Ä–º–∏–Ω–∞–ª –¥–æ—Å—Ç—É–ø–∞</div>
        <div class="code-entry-subtitle">–ö–æ—Ä–ø—É—Å –í | –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</div>
        <div class="code-inputs">
            <input class="code-digit" type="text" maxlength="1" inputmode="numeric" autocomplete="off">
            <input class="code-digit" type="text" maxlength="1" inputmode="numeric" autocomplete="off">
            <input class="code-digit" type="text" maxlength="1" inputmode="numeric" autocomplete="off">
            <input class="code-digit" type="text" maxlength="1" inputmode="numeric" autocomplete="off">
        </div>
        <div class="code-entry-status" id="code-status">–û–ñ–ò–î–ê–ù–ò–ï –í–í–û–î–ê...</div>
    </div>
    <div class="code-entry-footer">–£–ß–†–ï–ñ–î–ï–ù–ò–ï –ó–ê–ö–†–´–¢–û–ì–û –¢–ò–ü–ê | –°–ò–°–¢–ï–ú–ê v4.2.1</div>
</div>

<div id="game-window" style="display:none;">
    <!-- REC -->
    <div class="rec-badge"><div class="rec-dot"></div> REC</div>
    <!-- –ö–∞–º–µ—Ä–∞ –∏–Ω—Ñ–æ -->
    <div class="cam-info">CAM-04 | –ö–û–†–ü–£–°-–í | <span id="cam-time"></span></div>
    <!-- –ì–ª–∏—Ç—á-–ø–æ–ª–æ—Å–∞ -->
    <div id="glitch-bar" class="glitch-bar"></div>
    <!-- –®—É–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ -->
    <div id="noise-overlay" class="noise-overlay"></div>
    <!-- –í—Å–ø—ã—à–∫–∞ –ø–æ–º–µ—Ö -->
    <div id="screen-flash" class="screen-flash"></div>
    <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–º–µ—Ö–∞ -->
    <div id="v-glitch" class="v-glitch"></div>

    <div class="stats">
        <div id="state-image"><img id="state-img" src="state_1.png" alt="–û–±—ä–µ–∫—Ç 31"></div>
        <h3 style="color:white; margin: 2px 0;">–û–ë–™–ï–ö–¢ ‚Ññ31</h3>
        <div class="label">–ö–æ–Ω—Ç—Ä–æ–ª—å</div>
        <div class="stat-bar"><div id="control-bar" class="progress progress-control"></div></div>

        <div class="label">–°–≤—è–∑—å</div>
        <div class="stat-bar"><div id="bond-bar" class="progress progress-bond"></div></div>

        <div id="status-text" style="font-size: 0.7em; margin-top: 4px; color: #666;">
            –°–¢–ê–¢–£–°: –ù–∞–±–ª—é–¥–µ–Ω–∏–µ...
        </div>

        <!-- –ó–∞–º–µ—Ç–∫–∏ + –ì–ª–∞–∑ -->
        <div class="psych-panel">
            <div class="notebook" id="notebook">—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Å–º–æ—Ç—Ä. –æ–Ω –ø—Ä–æ—Å—Ç–æ –ø–∞—Ü–∏–µ–Ω—Ç.</div>
            <div class="eye-monitor" id="eye-monitor">
                <div class="eye-container">
                    <div class="eye-shape" id="eye-shape">
                        <div class="eye-pupil" id="eye-pupil"></div>
                    </div>
                </div>
                <div class="eye-label" id="eye-label">—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</div>
            </div>
        </div>
    </div>

    <div id="chat-area">
        <div id="messages"></div>
        <div id="actions" class="btn-grid"></div>
    </div>
</div>

<!-- –ü–æ—Å—Ç-–∫—Ä–µ–¥–∏—Ç–Ω–∞—è —Å—Ü–µ–Ω–∞ -->
<div id="post-credits">
    <div class="post-credits-text" id="post-credits-text"></div>
    <div class="post-credits-black" id="post-credits-end"></div>
</div>

<!-- –°–∫—Ä—ã—Ç–∞—è –∑–æ–Ω–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
<div id="print-area" style="display:none;"></div>

<script>
    // ==========================================
    // –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´
    // ==========================================
    let control = 70;
    let bond = 20;
    let isAnimating = false;
    let nameUnlocked = false;
    let currentStage = '';

    // ==========================================
    // –°–¶–ï–ù–ê–†–ò–ô v3.1
    // ==========================================
    const scenarios = {

        // === INTRO ===
        intro: {
            scene: `–¢—ã ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥. –ß–∞—Å—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞. –¢–µ–±—è –≤—ã–∑–≤–∞–ª–∏ –≤ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Ç–∏–ø–∞.\n\n–û–±—ä–µ–∫—Ç 31 ‚Äî –º—É–∂—á–∏–Ω–∞, 28‚Äì29 –ª–µ—Ç, —Å–µ—Ä–∏–π–Ω—ã–π —É–±–∏–π—Ü–∞. –¢—Ä–∏ –¥–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö –∂–µ—Ä—Ç–≤—ã, –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ —á–µ—Ç–≤—ë—Ä—Ç—É—é. –í—Å–µ ‚Äî –∂–µ–Ω—â–∏–Ω—ã. –í—Å–µ ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥–∏.\n\n–ß–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å –º–µ—Å—è—Ü–µ–≤ –æ–Ω –º–æ–ª—á–∞–ª. –î–≤–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –ø—ã—Ç–∞–ª–∏—Å—å ‚Äî –Ω–∏ —Å–ª–æ–≤–∞. –°–∏–¥–µ–ª, —Å–º–æ—Ç—Ä–µ–ª, —É–ª—ã–±–∞–ª—Å—è. –û–¥–Ω–∞ –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∞—Å—å —à–µ—Å—Ç—å —Å–µ—Å—Å–∏–π. –í—Ç–æ—Ä–∞—è ‚Äî –¥–≤–µ. –û–±–µ –Ω–∞–ø–∏—Å–∞–ª–∏ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤ –∑–∞–∫–ª—é—á–µ–Ω–∏–∏: ¬´–ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.¬ª\n\n–ü–µ—Ä–µ–¥ —Å–µ—Å—Å–∏–µ–π –æ—Ö—Ä–∞–Ω–Ω–∏–∫ –ø—Ä–æ—Ç—è–≥–∏–≤–∞–µ—Ç –∫–ª–æ—á–æ–∫ –±—É–º–∞–≥–∏: ¬´–û–Ω –ø—Ä–æ—Å–∏–ª –ø–µ—Ä–µ–¥–∞—Ç—å. –ì–æ–≤–æ—Ä–∏—Ç ‚Äî –æ—Ç–¥–∞—Å—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–º—É, –∫—Ç–æ –ø–æ–π–º—ë—Ç, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ.¬ª –ù–∞ –±—É–º–∞–∂–∫–µ ‚Äî –æ–¥–Ω–æ —Å–ª–æ–≤–æ. –ù–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤–æ–µ. –ü–æ—á–µ—Ä–∫ ‚Äî –∫–∞–∫ –±—É–¥—Ç–æ –ø–∏—Å–∞–ª –≤ —Ç–µ–º–Ω–æ—Ç–µ. –ò–ª–∏ —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏.\n\n–¢—ã –≤—Ö–æ–¥–∏—à—å. –î–≤–µ—Ä—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –ó–∞–º–æ–∫ —â—ë–ª–∫–∞–µ—Ç –¥–≤–∞–∂–¥—ã.\n\n–û–Ω —É–∂–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ —Ç—ã —Å—è–¥–µ—à—å.`,
            next: 'main_01'
        },

        // === –≠–¢–ê–ü 1 ‚Äî –ü–ï–†–í–´–ô –•–û–î ===
        main_01: {
            scene: `–ö–æ–º–Ω–∞—Ç–∞. –ë–µ—Ç–æ–Ω, —Ñ–ª—É–æ—Ä–µ—Å—Ü–µ–Ω—Ç–Ω—ã–π —Å–≤–µ—Ç, —Å—Ç–µ–∫–ª–æ —Ç–æ–ª—â–∏–Ω–æ–π –≤ –ª–∞–¥–æ–Ω—å. –ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—Å—Ç—Ä–æ–µ–Ω ‚Äî –≥–¥–µ –∏–º–µ–Ω–Ω–æ, –Ω–µ –≤–∏–¥–Ω–æ. –ö–∞–º–µ—Ä–∞ –≤ —É–≥–ª—É, –∫—Ä–∞—Å–Ω—ã–π –æ–≥–æ–Ω—ë–∫. –û–Ω —Å–∏–¥–∏—Ç. –†—É–∫–∏ –Ω–∞ —Å—Ç–æ–ª–µ ‚Äî –Ω–µ –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞, –∞ –ø–æ—Ç–æ–º—É —á—Ç–æ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã —Ç—ã –∏—Ö –≤–∏–¥–µ–ª–∞. –ß–∏—Å—Ç—ã–µ, —É—Ö–æ–∂–µ–Ω–Ω—ã–µ. –ù–æ–≥—Ç–∏ –∫–æ—Ä–æ—Ç–∫–æ –ø–æ–¥—Å—Ç—Ä–∏–∂–µ–Ω—ã. –ù–∞ —Å—Ä–µ–¥–Ω–µ–º –∏ –±–µ–∑—ã–º—è–Ω–Ω–æ–º –ø–∞–ª—å—Ü–µ –ª–µ–≤–æ–π —Ä—É–∫–∏ ‚Äî –ø–æ –±–ª–µ–¥–Ω–æ–π –ø–æ–ª–æ—Å–µ. –ë—ã–ª–∏ –∫–æ–ª—å—Ü–∞. –î–∞–≤–Ω–æ.\n\n–ö–æ–≥–¥–∞ —Ç—ã —Å–∞–¥–∏—à—å—Å—è, –æ–Ω –Ω–µ –∑–¥–æ—Ä–æ–≤–∞–µ—Ç—Å—è. –û–Ω —á—É—Ç—å –ø—Ä–∏–ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–µ–±—Ä–µ–∂–Ω–æ –≤—ã–±—Ä–∏—Ç—ã–π –ø–æ–¥–±–æ—Ä–æ–¥–æ–∫.\n\n–¢–∏—à–∏–Ω–∞. –û–Ω –∂–¥—ë—Ç. –¢—ã ‚Äî –ø–µ—Ä–≤–∞—è.`,
            choices: [
                { text: "–Ø –¥–æ–∫—Ç–æ—Ä –ï–ª–∏–∑–∞–≤–µ—Ç–∞ –õ–∞–ª–µ—Ç–∏–Ω–∞. –ù–∞—á–Ω—ë–º —Å –±–∞–∑–æ–≤–æ–≥–æ: –∫–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è?", control: +5, bond: 0, next: 'main_02', reaction: 'formal' },
                { text: "14 –º–µ—Å—è—Ü–µ–≤ –º–æ–ª—á–∞–Ω–∏—è. –î–≤–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∞ ‚Äî –Ω–∏ —Å–ª–æ–≤–∞. –ê –º–Ω–µ —Ç—ã –ø–µ—Ä–µ–¥–∞–ª –∑–∞–ø–∏—Å–∫—É. –ü–æ—á–µ–º—É?", control: +10, bond: +5, next: 'main_02', reaction: 'provoke' },
                { text: "–¢—ã –ø–µ—Ä–µ–¥–∞–ª –º–Ω–µ –±—É–º–∞–∂–∫—É —á–µ—Ä–µ–∑ –æ—Ö—Ä–∞–Ω—É. –ß—Ç–æ –Ω–∞ –Ω–µ–π –Ω–∞–ø–∏—Å–∞–Ω–æ?", control: +5, bond: +10, next: 'main_02', reaction: 'paper' },
                { text: "–Ø –õ–∏–∑–∞. –ú–æ–∂–Ω–æ –õ–∏–∑–∞–≤–µ—Ç–∞. –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å —ç—Ç–æ–≥–æ.", control: -5, bond: +20, next: 'main_02', reaction: 'name', unlock_name: true }
            ],
            reactions: {
                formal: `(–ø–∞—É–∑–∞) –ö–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É—é. (—á—É—Ç—å –Ω–∞–∫–ª–æ–Ω—è–µ—Ç –≥–æ–ª–æ–≤—É) –¢—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ —Ö–∏—â–Ω–∏–∫—É –∑–∞–¥–∞—é—Ç –≤–æ–ø—Ä–æ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å —á–µ—Å—Ç–Ω–æ, –Ω–µ –Ω–∞–ø—É–≥–∞–≤ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞? (—Ä–æ–≤–Ω–æ) –û–Ω –≥–æ–≤–æ—Ä–∏—Ç ¬´–Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª. –ù–æ—Ä–º–∞–ª—å–Ω–æ.`,
                provoke: `–ü–æ—á–µ–º—É —Ç–µ–±–µ. (–Ω–µ –≤–æ–ø—Ä–æ—Å ‚Äî —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Å–º–æ—Ç—Ä–∏—Ç –ø—Ä—è–º–æ) –¢–µ –¥–≤–µ ‚Äî –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ —Å –ø–∞–ø–∫–∞–º–∏. –° –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏. –° —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é, —á—Ç–æ –∑–Ω–∞—é—Ç, –∫—Ç–æ —è. –Ø –º–æ–ª—á–∞–ª ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å –±—ã–ª–æ –Ω–µ —Å –∫–µ–º. (–ø–∞—É–∑–∞) –ê —Ç—ã... —Ç—ã —Å–µ–ª–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞. –ù–µ –≤ –ø–∞–ø–∫—É ‚Äî –Ω–∞ –º–µ–Ω—è. –ó–∞–ø–∏—Å–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞. –¢—ã –ø—Ä–∏—à–ª–∞.`,
                paper: `(–≤–ø–µ—Ä–≤—ã–µ ‚Äî –º–∏–∫—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ: –ø–∞–ª–µ—Ü –¥—Ä–æ–≥–Ω—É–ª) –ü–µ—Ä–µ–¥–∞–ª–∏, –∑–Ω–∞—á–∏—Ç. (—Ç–∏—Ö–æ) –Ø –ø–∏—Å–∞–ª —ç—Ç–æ –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö. –ù–∏ –æ–¥–Ω–∞ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∞. –ù–µ –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ —Å–º–æ–≥–ª–∏ ‚Äî –Ω–µ –∑–∞—Ö–æ—Ç–µ–ª–∏. (–ø–∞—É–∑–∞) –≠—Ç–æ —Å–ª–æ–≤–æ –Ω—É–∂–Ω–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å. –¢–æ–≥–¥–∞ –±—É–∫–≤—ã –ø—Ä–æ—Å—Ç—É–ø—è—Ç. –ö –∫–æ–Ω—Ü—É ‚Äî –ø—Ä–æ—Å—Ç—É–ø—è—Ç. –ï—Å–ª–∏ —Ç—ã —Ç–∞, –∫–æ–º—É —è –º–æ–≥—É –µ–≥–æ –æ—Ç–¥–∞—Ç—å.`,
                name: `–õ–∏–∑–∞–≤–µ—Ç–∞... (–ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç –º–µ–¥–ª–µ–Ω–Ω–æ, –∫–∞–∫ –ø—Ä–æ–±—É–µ—Ç –Ω–∞ –≤–∫—É—Å) –ö—Ä–∞—Å–∏–≤–æ–µ. –¢—ã –∑–Ω–∞–ª–∞, —á—Ç–æ –∏–º—è ‚Äî —ç—Ç–æ –ø–µ—Ä–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å? (–ø–∞—É–∑–∞) –Ø –∑–∞–ø–æ–º–Ω—é.`
            }
        },

        // === –≠–¢–ê–ü 2 ‚Äî –î–ï–õ–û ===
        main_02: {
            scene: `–ü–∞–ø–∫–∞ –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π. –¢–æ–Ω–∫–∞—è. –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç—ã —É–∂–µ –≤–∏–¥–µ–ª–∞ ‚Äî –Ω–µ —Ö–æ—á–µ—Ç—Å—è –≤–∏–¥–µ—Ç—å —Å–Ω–æ–≤–∞. –¢—Ä–∏ –∂–µ–Ω—â–∏–Ω—ã. –ü—Å–∏—Ö–æ–ª–æ–≥–∏. 20‚Äì35 –ª–µ—Ç. –í—Å–µ –Ω–∞–π–¥–µ–Ω—ã –¥–æ–º–∞. –ù–µ –±—ã–ª–æ –≤–∑–ª–æ–º–∞. –ù–µ –±—ã–ª–æ –±–æ—Ä—å–±—ã. –ö–∞–∫ –±—É–¥—Ç–æ —Å–∞–º–∏ –æ—Ç–∫—Ä—ã–ª–∏ –¥–≤–µ—Ä—å. –ö–∞–∫ –±—É–¥—Ç–æ –∂–¥–∞–ª–∏.\n\n–°–ø–æ—Å–æ–± —Å–º–µ—Ä—Ç–∏ ‚Äî –∞—Å—Ñ–∏–∫—Å–∏—è. –ù–æ —Å–ª–µ–¥–æ–≤ —É–¥—É—à–µ–Ω–∏—è –Ω–µ—Ç. –ù–∏ –≤–µ—Ä—ë–≤–∫–∏, –Ω–∏ —Ä—É–∫, –Ω–∏ –ø–æ–¥—É—à–∫–∏. –ö–∞–∫ –±—É–¥—Ç–æ –≤–æ–∑–¥—É—Ö –ø—Ä–æ—Å—Ç–æ... –∫–æ–Ω—á–∏–ª—Å—è. –ò–ª–∏ –æ–Ω–∏ —Å–∞–º–∏ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –¥—ã—à–∞—Ç—å.\n\n–û–Ω —Å–º–æ—Ç—Ä–∏—Ç, –∫–∞–∫ —Ç—ã –ª–∏—Å—Ç–∞–µ—à—å –ø–∞–ø–∫—É. –ù–µ –Ω–∞ –ø–∞–ø–∫—É ‚Äî –Ω–∞ —Ç–≤–æ—ë –ª–∏—Ü–æ.`,
            choices: [
                { text: "–¢—Ä–∏ –∂–µ—Ä—Ç–≤—ã. –í—Å–µ –∏–∑ –æ–¥–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏. –ü–æ—á–µ–º—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏?", control: +10, bond: +5, next: 'main_03', reaction: 'choice' },
                { text: "–ù–µ –±—ã–ª–æ –≤–∑–ª–æ–º–∞. –û–Ω–∏ –æ—Ç–∫—Ä—ã–ª–∏ –¥–≤–µ—Ä—å. –ß—Ç–æ —Ç—ã –∏–º –≥–æ–≤–æ—Ä–∏–ª?", control: +5, bond: +10, next: 'main_03', reaction: 'door' },
                { text: "–ê—Å—Ñ–∏–∫—Å–∏—è –±–µ–∑ —Å–ª–µ–¥–æ–≤. –¢—ã –≤–∏–¥–µ–ª –∏—Ö –≥–ª–∞–∑–∞. –ß—Ç–æ –≤ –Ω–∏—Ö –±—ã–ª–æ?", control: 0, bond: +15, next: 'main_03', reaction: 'feel' },
                { text: "–í –¥–µ–ª–µ —Ç—Ä–∏ –∂–µ—Ä—Ç–≤—ã. –ù–æ –µ—Å—Ç—å —á–µ—Ç–≤—ë—Ä—Ç–∞—è. –¢–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –Ω–µ —Ç—Ä–æ–Ω—É–ª. –ü–æ—á–µ–º—É?", control: +5, bond: +20, next: 'main_03', reaction: 'fourth', lock: { bond_min: 30, lock_text: "–û–Ω –≤–∞–º –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç" }, clue: true, clue_text: `¬´–Ø —Å—Ç–æ—è–ª –Ω–∞–¥ –Ω–µ–π. –ß–∞—Å, –º–æ–∂–µ—Ç –±–æ–ª—å—à–µ. –ü–æ—Ç–æ–º —É—à—ë–ª. –£ –¥–≤–µ—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è. –û—Ç–∫—Ä—ã–ª —Ä–æ—Ç. –ó–∞–∫—Ä—ã–ª. –£—à—ë–ª.¬ª` }
            ],
            reactions: {
                choice: `–ü–æ—á–µ–º—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏. (–Ω–µ –≤–æ–ø—Ä–æ—Å ‚Äî —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) –ü–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ ‚Äî –∂—Ä–µ—Ü—ã. –£ –Ω–∏—Ö –µ—Å—Ç—å —Å–≤—è—â–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–æ: –Ω–∞–∑–≤–∞—Ç—å. –î–∞—Ç—å –∏–º—è. ¬´–°–î–í–ì—à–Ω–∏–∫¬ª. ¬´–ù–∞—Ä—Ü–∏—Å—Å¬ª. ¬´–ü–†–õ¬ª. (–≥–æ–ª–æ—Å —Ä–æ–≤–Ω—ã–π, –Ω–æ —á—Ç–æ-—Ç–æ –ø–æ–¥ –Ω–∏–º –≥—É–¥–∏—Ç) –ó–Ω–∞–µ—à—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫—É –¥–∞—é—Ç –∏–º—è? –ù–∞—Å—Ç–æ—è—â–µ–µ –∏—Å—á–µ–∑–∞–µ—Ç. –û—Å—Ç–∞—ë—Ç—Å—è ‚Äî –¥–∏–∞–≥–Ω–æ–∑. –®—Ç–∞–º–ø. –ü–∞–ø–∫–∞. –ü–æ–ª–∫–∞.\n\n–ê –ø–æ—Ç–æ–º –æ–Ω–∏ —É—á–∞—Ç –æ–±—ã—á–Ω—ã—Ö –ª—é–¥–µ–π: ¬´—Å—Ç–∞–≤—å –≥—Ä–∞–Ω–∏—Ü—ã¬ª, ¬´–æ–Ω —Ç–æ–∫—Å–∏—á–Ω—ã–π¬ª, ¬´—ç—Ç–æ –∞–±—å—é–∑¬ª. –ò –ª—é–¥–∏ —Ä–∞–¥–æ—Å—Ç–Ω–æ –≤–µ—à–∞—é—Ç —è—Ä–ª—ã–∫–∏ –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞. –ú–∞—Ç—å ‚Äî –¥–æ—á–µ—Ä–∏. –ú—É–∂ ‚Äî –∂–µ–Ω–µ. –î—Ä—É–≥ ‚Äî –¥—Ä—É–≥—É. ¬´–¢—ã –Ω–∞—Ä—Ü–∏—Å—Å¬ª ‚Äî –∏ –≤—Å—ë, —Ä–∞–∑–≥–æ–≤–æ—Ä –æ–∫–æ–Ω—á–µ–Ω. –ù–µ –Ω—É–∂–Ω–æ —Å–ª—ã—à–∞—Ç—å, –ø–æ–Ω–∏–º–∞—Ç—å, —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è. –î–∏–∞–≥–Ω–æ–∑ –≤—Å—ë —Ä–µ—à–∏–ª.\n\n–¢—Ä–∏ –∂–µ–Ω—â–∏–Ω—ã –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ ‚Äî —Å—Ç–∞–≤–∏–ª–∏ –¥–∏–∞–≥–Ω–æ–∑—ã –∫–∞–∫ –ø—Ä–∏–≥–æ–≤–æ—Ä—ã. –ù–µ —á—Ç–æ–±—ã –ª–µ—á–∏—Ç—å. –ß—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å.`,
                door: `–ß—Ç–æ –≥–æ–≤–æ—Ä–∏–ª? (—á—É—Ç—å —É–ª—ã–±–∞–µ—Ç—Å—è ‚Äî –Ω–µ—Ö–æ—Ä–æ—à–∞—è —É–ª—ã–±–∫–∞) –ü—Ä–∞–≤–¥—É. –í—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–¥—É. –ì–æ–≤–æ—Ä–∏–ª: ¬´–Ø —Ö–æ—á—É –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å. –ü—Ä–æ—Å—Ç–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å.¬ª (–ø–∞—É–∑–∞) –ò –æ–Ω–∏ –≤–µ—Ä–∏–ª–∏. –ü–æ—Ç–æ–º—É —á—Ç–æ —Ö–æ—Ç–µ–ª–∏ –≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç. –ß—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –∫–æ–º—É —É–≥–æ–¥–Ω–æ.`,
                feel: `(–¥–æ–ª–≥–∞—è –ø–∞—É–∑–∞, —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Å–≤–æ–∏ —Ä—É–∫–∏) –ì–ª–∞–∑–∞. –î–∞. (—Ç–∏—Ö–æ) –£–¥–∏–≤–ª–µ–Ω–∏–µ. –ù–µ —Å—Ç—Ä–∞—Ö ‚Äî —É–¥–∏–≤–ª–µ–Ω–∏–µ. –ö–∞–∫ –±—É–¥—Ç–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ–∫—É–Ω–¥—ã –æ–Ω–∏ –≤–µ—Ä–∏–ª–∏, —á—Ç–æ —ç—Ç–æ ‚Äî —á–∞—Å—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞. –ß–∞—Å—Ç—å —Ç–µ—Ä–∞–ø–∏–∏. –≠—Ç–æ –ø—É–≥–∞–µ—Ç —Ç–µ–±—è?`,
                fourth: `(–∑–∞–º–∏—Ä–∞–µ—Ç ‚Äî –Ω–∞—Å—Ç–æ—è—â–∞—è —Ä–µ–∞–∫—Ü–∏—è, –ø–µ—Ä–≤–∞—è –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è) –ß–µ—Ç–≤—ë—Ä—Ç–∞—è... –û—Ç–∫—É–¥–∞ —Ç—ã... (–±–µ—Ä—ë—Ç –ø–∞—É–∑—É, —Å–∂–∏–º–∞–µ—Ç —Ä—É–∫–∏) –î–∞. –ë—ã–ª–∞ —á–µ—Ç–≤—ë—Ä—Ç–∞—è. –Ø —Å—Ç–æ—è–ª –≤ –µ—ë –∫–≤–∞—Ä—Ç–∏—Ä–µ. –ù–æ—á—å—é. –û–Ω–∞ —Å–ø–∞–ª–∞. (—à—ë–ø–æ—Ç) –ù–æ –æ–Ω–∞ –≤–æ —Å–Ω–µ... —É–ª—ã–±–Ω—É–ª–∞—Å—å. –ö–∞–∫ —Ä–µ–±—ë–Ω–æ–∫. –ò —è –ø–æ–Ω—è–ª, —á—Ç–æ –µ—Å–ª–∏ –ø—Ä–∏–∫–æ—Å–Ω—É—Å—å ‚Äî —Å–ª–æ–º–∞—é —á—Ç–æ-—Ç–æ, —á–µ–≥–æ –Ω–µ —Å–º–æ–≥—É –ø–æ—á–∏–Ω–∏—Ç—å. –ù–µ –µ—ë. –°–µ–±—è.`
            }
        },

        // === –≠–¢–ê–ü 3 ‚Äî –ü–ï–†–í–ê–Ø –ö–û–ù–¢–†–ê–¢–ê–ö–ê ===
        main_03: {
            scene: `–û–Ω –æ—Ç–≤–µ—á–∞–ª. –û–Ω –±—ã–ª –æ–±—ä–µ–∫—Ç–æ–º. –ù–æ —Å–µ–π—á–∞—Å —á—Ç–æ-—Ç–æ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è. –û–Ω –ø–æ–¥–∞—ë—Ç—Å—è –≤–ø–µ—Ä—ë–¥ ‚Äî —Å–æ–≤—Å–µ–º —á—É—Ç—å-—á—É—Ç—å. –°–∞–Ω—Ç–∏–º–µ—Ç—Ä. –ù–æ —Ç—ã –∑–∞–º–µ—á–∞–µ—à—å.\n\n‚Äî –¢—ã —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å. –õ—É—á—à–µ –¥—Ä—É–≥–∏—Ö. –ù–æ —è –∑–∞–º–µ—Ç–∏–ª ‚Äî —Ç—ã –Ω–µ –ø–∏—à–µ—à—å. –ë–ª–æ–∫–Ω–æ—Ç –∑–∞–∫—Ä—ã—Ç —Å –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏. –†—É—á–∫–∞ ‚Äî –∫–æ–ª–ø–∞—á–æ–∫ –Ω–µ —Å–Ω—è—Ç. (–ø–∞—É–∑–∞) –≠—Ç–æ –Ω–µ –¥–ª—è –æ—Ç—á—ë—Ç–∞. –¢—ã –∑–¥–µ—Å—å –Ω–µ –¥–ª—è —É—á—Ä–µ–∂–¥–µ–Ω–∏—è. –¢—ã –∑–¥–µ—Å—å –¥–ª—è —Å–µ–±—è. (—Ç–∏—à–µ) –ó–∞—á–µ–º —Ç–µ–±–µ —è?`,
            choices: [
                { text: "–ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞ —Å–ø–∏—Å–∞–ª–∞.", control: 0, bond: +10, next: 'main_04' },
                { text: "–í–æ–ø—Ä–æ—Å—ã –∑–∞–¥–∞—é —è. –¢—ã —É–∫–ª–æ–Ω—è–µ—à—å—Å—è ‚Äî –ø–æ—á–µ–º—É?", control: +15, bond: -10, next: 'main_04' },
                { text: "–ù–µ –∑–Ω–∞—é. –ß–µ—Å—Ç–Ω–æ. –ò —ç—Ç–æ –º–µ–Ω—è –±–µ—Å–ø–æ–∫–æ–∏—Ç.", control: -10, bond: +15, next: 'branch_A', branch: true },
                { text: "–¢—ã –ø–µ—Ä–µ–≤–æ–¥–∏—à—å –Ω–∞ –º–µ–Ω—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä –∏–¥—ë—Ç –æ —Ç–µ–±–µ. –≠—Ç–æ –∑–∞—â–∏—Ç–∞.", control: +10, bond: +5, next: 'main_04' }
            ]
        },

        // === –í–ï–¢–ö–ê –ê ===
        branch_A: {
            scene: `‚Äî –ù–µ –∑–Ω–∞–µ—à—å... (–æ—Ç–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è, –∏–∑—É—á–∞–µ—Ç) –ë–µ—Å–ø–æ–∫–æ–∏—Ç. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ. –¢–µ, –∫—Ç–æ –∑–Ω–∞–ª –∑–∞—á–µ–º ‚Äî —É—Ö–æ–¥–∏–ª–∏ –±—ã—Å—Ç—Ä–æ. –£ –Ω–∏—Ö –±—ã–ª–∞ —Ü–µ–ª—å, –±—ã–ª –ø—Ä–æ—Ç–æ–∫–æ–ª. –û—Ç—Ä–∞–±–æ—Ç–∞–ª, —É—à—ë–ª. (—Ç–∏—Ö–æ) –¢–µ, –∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç –∑–∞—á–µ–º, ‚Äî –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è. –ü–æ—Ç–æ–º—É —á—Ç–æ –æ—Ç–≤–µ—Ç –≥–¥–µ-—Ç–æ –∑–¥–µ—Å—å. –ú–µ–∂–¥—É –Ω–∞–º–∏. –í —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–µ.\n\n(–ø–∞—É–∑–∞) –°–∫–∞–∂–∏... —Ç—ã —á–∞—Å—Ç–æ –Ω–µ –∑–Ω–∞–µ—à—å, –∑–∞—á–µ–º –¥–µ–ª–∞–µ—à—å —Ç–æ, —á—Ç–æ –¥–µ–ª–∞–µ—à—å?`,
            choices: [
                { text: "–ß–∞—â–µ, —á–µ–º —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã.", control: -5, bond: +10, next: 'main_04', clue: true, clue_text: `¬´–ó–Ω–∞–µ—à—å, —á—Ç–æ –æ–±—â–µ–≥–æ –º–µ–∂–¥—É –∑–∞–º–∫–æ–º –∏ —Å–ª–æ–≤–æ–º? –û–±–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã, –µ—Å–ª–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–µ –≤ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É. –ê –≤ –Ω—É–∂–Ω—É—é ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é—Ç.¬ª` },
                { text: "–ú—ã –∑–¥–µ—Å—å –Ω–µ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –º–æ–∏—Ö –º–æ—Ç–∏–≤–∞—Ü–∏–π.", control: +10, bond: -5, next: 'main_04' },
                { text: "–ê —Ç—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–ª, –∑–∞—á–µ–º?", control: +5, bond: +10, next: 'main_04', clue: true, clue_text: `¬´–ó–Ω–∞–µ—à—å, —á—Ç–æ –æ–±—â–µ–≥–æ –º–µ–∂–¥—É –∑–∞–º–∫–æ–º –∏ —Å–ª–æ–≤–æ–º? –û–±–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã, –µ—Å–ª–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–µ –≤ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É. –ê –≤ –Ω—É–∂–Ω—É—é ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é—Ç.¬ª` }
            ]
        },

        // === –≠–¢–ê–ü 4 ‚Äî –ì–õ–£–ë–ñ–ï ===
        main_04: {
            scene: `–î–≤–∞–¥—Ü–∞—Ç—å –º–∏–Ω—É—Ç. –ü–∞–ª—å—Ü—ã –ø–æ—Å—Ç—É–∫–∏–≤–∞—é—Ç –ø–æ —Å—Ç–æ–ª—É. –†–∏—Ç–º ‚Äî –Ω–µ—Ä–æ–≤–Ω—ã–π, –Ω–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è. –¢—ã –∑–∞–º–µ—á–∞–µ—à—å: –æ–Ω —Å—á–∏—Ç–∞–µ—Ç. –ì—É–±—ã —á—É—Ç—å —à–µ–≤–µ–ª—è—Ç—Å—è. –ß–∏—Å–ª–∞.`,
            choices: [
                { text: "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ –¥–æ –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ. –ö–µ–º —Ç—ã –±—ã–ª?", control: +5, bond: +5, next: 'main_05', reaction: 'childhood' },
                { text: "–¢—ã —Å–º–æ—Ç—Ä–µ–ª –∏–º –≤ –ª–∏—Ü–æ. –≠—Ç–æ –±—ã–ª–æ —á–∞—Å—Ç—å—é —Ä–∏—Ç—É–∞–ª–∞?", control: +10, bond: +10, next: 'main_05', reaction: 'method' },
                { text: "–ö—Ç–æ –ø—Ä–∏—á–∏–Ω–∏–ª —Ç–µ–±–µ –±–æ–ª—å –ø–µ—Ä–≤—ã–º? –ù–µ –∂–µ—Ä—Ç–≤—ã ‚Äî –¥–æ –Ω–∏—Ö.", control: 0, bond: +20, next: 'main_05', reaction: 'wound', lock: { bond_min: 40, lock_text: "–û–Ω –≤–∞–º –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç" }, clue: true, clue_text: `¬´–û–Ω–∞ –ø–æ—Å—Ç–∞–≤–∏–ª–∞ –¥–∏–∞–≥–Ω–æ–∑ –∏ –≤—ã—à–ª–∞. –ó–∞–∫—Ä—ã–ª–∞ –¥–≤–µ—Ä—å. –Ø —Å–∏–¥–µ–ª –∏ –∂–¥–∞–ª. –°–∞–º –Ω–µ –∑–Ω–∞–ª —á–µ–≥–æ. –ü–æ—Ç–æ–º –ø–æ–Ω—è–ª ‚Äî –∂–¥–∞–ª, —á—Ç–æ –¥–≤–µ—Ä—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–Ω–æ–≤–∞. –ù–µ –æ—Ç–∫—Ä—ã–ª–∞—Å—å.¬ª` },
                { text: "–¢—ã —Å—á–∏—Ç–∞–µ—à—å. –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å. –ì—É–±—ã –¥–≤–∏–≥–∞—é—Ç—Å—è. –ß—Ç–æ —Å—á–∏—Ç–∞–µ—à—å?", control: +5, bond: +10, next: 'branch_B', branch: true }
            ],
            reactions: {
                childhood: `–ö–µ–º –±—ã–ª... (–ø–∞—É–∑–∞, —Å–º–æ—Ç—Ä–∏—Ç –≤ —Å—Ç–æ–ª) –û–±—ã—á–Ω—ã–º. –¢–∏—Ö–∏–º. –ß–∏—Ç–∞–ª –º–Ω–æ–≥–æ. –°–∏–¥–µ–ª –≤ —É–≥–ª—É, —Å–ª—É—à–∞–ª, –∫–∞–∫ –ª—é–¥–∏ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç. –ù–µ —Å –Ω–∏–º–∏ ‚Äî —Ä—è–¥–æ–º. (—Ä–æ–≤–Ω–æ, –æ—Ç—Ä–µ–ø–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ) –Ø –Ω–∞—É—á–∏–ª—Å—è —Å–ª—É—à–∞—Ç—å —Ç–∏—à–∏–Ω—É. –¢–∏—à–∏–Ω–∞ ‚Äî —Å–∞–º—ã–π —á–µ—Å—Ç–Ω—ã–π –∑–≤—É–∫. –í –Ω–µ–π –Ω–µ—Ç –ø—Ä–∏—Ç–≤–æ—Ä—Å—Ç–≤–∞. (–ø–∞—É–∑–∞) –ê –ø–æ—Ç–æ–º —Ç–∏—à–∏–Ω–∞ –∫–æ–Ω—á–∏–ª–∞—Å—å. –ò —è –ø–æ–Ω—è–ª, —á—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ω–µ—ë —É–∂–µ –Ω–µ –≤–æ–π—Ç–∏.`,
                method: `–†–∏—Ç—É–∞–ª... –ù–µ—Ç. –ù–µ —Ä–∏—Ç—É–∞–ª. (–¥—É–º–∞–µ—Ç) –†–∞–∑–≥–æ–≤–æ—Ä. –î–æ–ª–≥–∏–π. –ß–µ—Å—Ç–Ω—ã–π. –¢–æ—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã. (—Ç–∏—Ö–æ) –Ø –≥–æ–≤–æ—Ä–∏–ª –ø—Ä–∞–≤–¥—É ‚Äî –∞ –æ–Ω–∏ –∑–∞–¥—ã—Ö–∞–ª–∏—Å—å –æ—Ç –Ω–µ—ë. –ú–∞—Å–∫–∞ –ø–∞–¥–∞–ª–∞. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è, –≤—Å—ë. –û—Å—Ç–∞–≤–∞–ª–æ—Å—å ‚Äî –Ω–∞—Å—Ç–æ—è—â–µ–µ –ª–∏—Ü–æ. (–ø–∞—É–∑–∞) –ò—Ä–æ–Ω–∏—è –≤ —Ç–æ–º, —á—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ –ª–∏—Ü–æ ‚Äî –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ. –£ –≤—Å–µ—Ö.`,
                wound: `(—á–µ–ª—é—Å—Ç—å —Å–∂–∏–º–∞–µ—Ç—Å—è) –ü–µ—Ä–≤–æ–π... –±—ã–ª–∞ –Ω–µ —á–µ–ª–æ–≤–µ–∫. –ë—ã–ª–æ ‚Äî —Å–ª–æ–≤–æ. (–¥–æ–ª–≥–∞—è –ø–∞—É–∑–∞) –ú–Ω–µ —Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å. –ö–∞–±–∏–Ω–µ—Ç. –î–≤–∞–¥—Ü–∞—Ç—å –º–∏–Ω—É—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞. –û–Ω–∞ –∫–∏–≤–∞–ª–∞, –ø–∏—Å–∞–ª–∞, –∫–∏–≤–∞–ª–∞. –ü–æ—Ç–æ–º —Å–∫–∞–∑–∞–ª–∞: ¬´–ê–Ω—Ç–∏—Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ª–∏—á–Ω–æ—Å—Ç–∏¬ª. –ö–∞–∫ –±—É–¥—Ç–æ –æ–±—ä—è–≤–ª—è–µ—Ç –ø–æ–≥–æ–¥—É. –ë—É–¥–Ω–∏—á–Ω–æ.\n\n(–≥–æ–ª–æ—Å –ª–æ–º–∞–µ—Ç—Å—è –Ω–∞ —Å–µ–∫—É–Ω–¥—É) –Ø —Å–ø—Ä–æ—Å–∏–ª: ¬´–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?¬ª –û–Ω–∞ —Å–∫–∞–∑–∞–ª–∞: ¬´–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Ç–µ–±–µ –±—É–¥–µ—Ç —Ç—Ä—É–¥–Ω–æ.¬ª –ò –≤—Å—ë. –ù–∏ –ø–æ–º–æ—â–∏, –Ω–∏ –ø–ª–∞–Ω–∞, –Ω–∏ ¬´–º—ã —Ä–∞–∑–±–µ—Ä—ë–º—Å—è¬ª. –®—Ç–∞–º–ø. –ü–∞–ø–∫–∞. –°–ª–µ–¥—É—é—â–∏–π.\n\n(–ø–∞—É–∑–∞) –° —Ç–µ—Ö –ø–æ—Ä –∫–∞–∂–¥—ã–π, –∫—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–ª –º–æ—é –∫–∞—Ä—Ç—É, –≤–∏–¥–µ–ª –Ω–µ –º–µ–Ω—è. –í–∏–¥–µ–ª ‚Äî —Å–ª–æ–≤–æ. –ò –∑–Ω–∞–µ—à—å —á—Ç–æ —Å–∞–º–æ–µ —Å—Ç—Ä–∞—à–Ω–æ–µ? –û–Ω–∏ –Ω–∞—á–∞–ª–∏ —É—á–∏—Ç—å –æ–±—ã—á–Ω—ã—Ö –ª—é–¥–µ–π –¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ. ¬´–û–ø—Ä–µ–¥–µ–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∑–∞ –ø—è—Ç—å —à–∞–≥–æ–≤¬ª. ¬´–ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞—Ä—Ü–∏—Å—Å–∞¬ª. ¬´–ö–∞–∫ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ–∑ –ø–∞—Ä—Ç–Ω—ë—Ä—É¬ª. –ò –º–∏—Ä —Å—Ç–∞–ª ‚Äî –∑–æ–æ–ø–∞—Ä–∫–æ–º, –≥–¥–µ –≤—Å–µ —Ä–∞–∑–≤–µ—à–∏–≤–∞—é—Ç —Ç–∞–±–ª–∏—á–∫–∏ –Ω–∞ –∫–ª–µ—Ç–∫–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.\n\n(—Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–µ–±—è) –ê —Ç—ã? –¢—ã —Ç–æ–∂–µ –≤–µ—à–∞–µ—à—å —Ç–∞–±–ª–∏—á–∫–∏?`
            }
        },

        // === –í–ï–¢–ö–ê –ë ===
        branch_B: {
            scene: `‚Äî (–∑–∞–º–∏—Ä–∞–µ—Ç ‚Äî —Ç—ã –ø–æ–π–º–∞–ª–∞ –µ–≥–æ) –°—á–∏—Ç–∞—é... (—Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Å–≤–æ–∏ –ø–∞–ª—å—Ü—ã, –±—É–¥—Ç–æ –ø—Ä–µ–¥–∞–ª–∏) –¢—Ä–µ—â–∏–Ω—ã. –ù–∞ —Å—Ç–µ–Ω–µ. –°—Ç–æ –¥–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–∏. –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è—é. –ï—Å–ª–∏ —á–∏—Å–ª–æ —Ç–æ –∂–µ ‚Äî –º–∏—Ä –≤ –ø–æ—Ä—è–¥–∫–µ. –ï—Å–ª–∏ –Ω–µ—Ç... (–Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç) –¢—ã —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ—à—å. –®–∞–≥–∏, –∫–∞–ª–æ—Ä–∏–∏, —Å–µ–∫—É–Ω–¥—ã —Ç–∏—à–∏–Ω—ã. –ö–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ —á–∏—Å–ª–∞. –ú—ã –æ–±–∞.`,
            choices: [
                { text: "–ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ —Ç—Ä–µ—â–∏–Ω —Å—Ç–∞–Ω–µ—Ç 124?", control: +5, bond: +10, next: 'main_05', clue: true, clue_text: `¬´–ó–Ω–∞–µ—à—å, —á—Ç–æ —Å—Ç—Ä–∞—à–Ω–µ–µ —Ç–∏—à–∏–Ω—ã? –¢–∏—à–∏–Ω–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–æ–≤–æ. –ö–æ–≥–¥–∞ –≤—Å–µ –∑–Ω–∞—é—Ç –∫–∞–∫–æ–µ ‚Äî –∏ –Ω–∏–∫—Ç–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç.¬ª` },
                { text: "–ú—ã –Ω–µ ¬´–æ–±–∞¬ª. –Ø –Ω–µ –∑–∞ —Å—Ç–µ–∫–ª–æ–º.", control: +10, bond: -10, next: 'main_05' },
                { text: "–ú–æ–∂–µ—Ç –±—ã—Ç—å. –ö–æ–Ω—Ç—Ä–æ–ª—å ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—Å—ë —Ä—É—à–∏—Ç—Å—è.", control: -5, bond: +15, next: 'main_05', clue: true, clue_text: `¬´–ó–Ω–∞–µ—à—å, —á—Ç–æ —Å—Ç—Ä–∞—à–Ω–µ–µ —Ç–∏—à–∏–Ω—ã? –¢–∏—à–∏–Ω–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª–æ–≤–æ. –ö–æ–≥–¥–∞ –≤—Å–µ –∑–Ω–∞—é—Ç –∫–∞–∫–æ–µ ‚Äî –∏ –Ω–∏–∫—Ç–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç.¬ª` }
            ]
        },

        // === –≠–¢–ê–ü 5 ‚Äî –û–ù –í–ò–î–ò–¢ –¢–ï–ë–Ø ===
        main_05: {
            scene: `–¢—Ä–∏–¥—Ü–∞—Ç—å –º–∏–Ω—É—Ç. –¢—ã –≤–µ–ª–∞. –¢—ã –∑–∞–¥–∞–≤–∞–ª–∞ –≤–æ–ø—Ä–æ—Å—ã. –¢—ã –±—ã–ª–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–º.\n\n–û–Ω –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ. –ù–µ —Å–µ—Ä–∏—é ‚Äî –æ–¥–Ω–æ. –¢–æ—á–Ω–æ–µ.\n\n‚Äî (—Ç–∏—Ö–æ, –ø–æ—á—Ç–∏ –º—è–≥–∫–æ) –°–µ—Ä—å–≥–∏ —Å –∫—Ä–µ—Å—Ç–∞–º–∏. –ö–æ–ª—å—Ü–∞ –Ω–∞ —Ä—É–∫–∞—Ö —Ç–æ–∂–µ —Å –∫—Ä–µ—Å—Ç–∞–º–∏. –°–µ—Ä–µ–±—Ä–æ ‚Äî –Ω–µ –∑–æ–ª–æ—Ç–æ. –ù–µ –ø–æ–¥–∞—Ä–æ–∫ ‚Äî —Å–∞–º–∞ –∫—É–ø–∏–ª–∞. –ü–æ—Å–ª–µ —á–µ–≥–æ-—Ç–æ. –ü–æ—Ç–µ—Ä—è –∏–ª–∏ —Ä–µ—à–µ–Ω–∏–µ. (–ø–∞—É–∑–∞) –¢—ã —Ç—Ä–æ–≥–∞–µ—à—å –∏—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —è –≥–æ–≤–æ—Ä—é —á—Ç–æ-—Ç–æ, —á—Ç–æ –ø–æ–ø–∞–¥–∞–µ—Ç. –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –ø–∞–ª–µ—Ü –Ω–∞ –∫–æ–ª—å—Ü–µ.\n\n–¢—ã –æ–ø—É—Å–∫–∞–µ—à—å –≤–∑–≥–ª—è–¥. –û–Ω –ø—Ä–∞–≤.\n\n‚Äî –û–Ω–∏ —Ç–æ–∂–µ —ç—Ç–æ –¥–µ–ª–∞–ª–∏. –í—Å–µ —Ç—Ä–∏. –£ –∫–∞–∂–¥–æ–π –±—ã–ª —Å–≤–æ–π —è–∫–æ—Ä—å. –†—É—á–∫–∞. –ß–∞—Å—ã. –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Ö–∞–ª–∞—Ç–µ. (—Ç–∏—Ö–æ) –ü—Ä–µ–¥–º–µ—Ç, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—à—å—Å—è, –∫–æ–≥–¥–∞ –∑–µ–º–ª—è —É—Ö–æ–¥–∏—Ç. –¢–æ–ª—å–∫–æ —Ç—ã ‚Äî –ø–µ—Ä–≤–∞—è, –∫—Ç–æ –¥–µ—Ä–∂–∏—Ç—Å—è –∑–∞ –∫—Ä–µ—Å—Ç.`,
            choices: [
                { text: "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –Ω–∞–≤—ã–∫. –ù–µ —Å—É–ø–µ—Ä—Å–∏–ª–∞. –ß—Ç–æ —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è —ç—Ç–∏–º —Å–∫–∞–∑–∞—Ç—å?", control: +10, bond: +5, next: 'main_06' },
                { text: "–¢—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ª —è–∫–æ—Ä—è –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤. –≠—Ç–æ –±—ã–ª–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞?", control: +15, bond: 0, next: 'main_06' },
                { text: "–ü–æ—Ç–µ—Ä—è. –¢—ã —É–≥–∞–¥–∞–ª. –ù–æ —ç—Ç–æ –Ω–µ —Ç–≤–æ—ë.", control: -5, bond: +15, next: 'main_06', clue: true, clue_text: `¬´–ü–æ—Å–ª–µ–¥–Ω—è—è... —Ç—Ä–µ—Ç—å—è. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫... –û–Ω–∞ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞ –Ω–∞ –º–µ–Ω—è. –ò —è —É–≤–∏–¥–µ–ª ‚Äî –æ–Ω–∞ –ø–æ–Ω—è–ª–∞. –í—Å—ë –ø–æ–Ω—è–ª–∞. –ò –∂–¥–∞–ª–∞, —á—Ç–æ —è —Å–∫–∞–∂—É. –û–¥–Ω–æ —Å–ª–æ–≤–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ. –¢–æ, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è. (–ø–∞—É–∑–∞) –Ø –Ω–µ —Å–∫–∞–∑–∞–ª.¬ª` },
                { text: "–ö—Ä–µ—Å—Ç ‚Äî –Ω–µ —è–∫–æ—Ä—å. –ö—Ä–µ—Å—Ç ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –ß—Ç–æ —è –º–æ–≥—É —Å–ª–æ–º–∞—Ç—å—Å—è –∏ —á—Ç–æ —É–∂–µ –ª–æ–º–∞–ª–∞—Å—å.", control: -15, bond: +20, next: 'main_06', lock: { bond_min: 50 }, warn: true, clue: true, clue_text: `¬´–ü–æ—Å–ª–µ–¥–Ω—è—è... —Ç—Ä–µ—Ç—å—è. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫... –û–Ω–∞ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞ –Ω–∞ –º–µ–Ω—è. –ò —è —É–≤–∏–¥–µ–ª ‚Äî –æ–Ω–∞ –ø–æ–Ω—è–ª–∞. –í—Å—ë –ø–æ–Ω—è–ª–∞. –ò –∂–¥–∞–ª–∞, —á—Ç–æ —è —Å–∫–∞–∂—É. –û–¥–Ω–æ —Å–ª–æ–≤–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ. –¢–æ, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è. (–ø–∞—É–∑–∞) –Ø –Ω–µ —Å–∫–∞–∑–∞–ª.¬ª` }
            ]
        },

        // === –≠–¢–ê–ü 6 ‚Äî –û–ë–ú–ï–ù ===
        main_06: {
            scene: `–°–æ—Ä–æ–∫ –º–∏–Ω—É—Ç. –°–≤–µ—Ç –Ω–∞—á–∞–ª –º–µ—Ä—Ü–∞—Ç—å ‚Äî –∏–ª–∏ —Ç–µ–±–µ –∫–∞–∂–µ—Ç—Å—è. –í–æ–∑–¥—É—Ö —Ç—è–∂—ë–ª—ã–π. –û–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç.\n\n‚Äî –î–≤–∞–¥—Ü–∞—Ç—å –º–∏–Ω—É—Ç. (–Ω–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —á–∞—Å—ã ‚Äî –∑–Ω–∞–µ—Ç) –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –¢—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å ‚Äî —è –æ—Ç–≤–µ—á–∞—é —á–µ—Å—Ç–Ω–æ. –Ø —Å–ø—Ä–∞—à–∏–≤–∞—é ‚Äî —Ç—ã –æ—Ç–≤–µ—á–∞–µ—à—å —á–µ—Å—Ç–Ω–æ. –ë–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –ë–µ–∑ —Å—Ç–µ–∫–ª–∞ –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏.\n\n(–ø–∞—É–∑–∞) –ò–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º. –ü—Ä–∞–≤–∏–ª–∞ —É–¥–æ–±–Ω—ã. –ë–µ–∑–æ–ø–∞—Å–Ω—ã. –ü—Ä–∞–≤–∏–ª–∞ ‚Äî –∫–ª–µ—Ç–∫–∞. –î–ª—è –Ω–∞—Å –æ–±–æ–∏—Ö.`,
            choices: [
                { text: "–ü—Ä–∏–Ω–∏–º–∞—é. –í–æ–ø—Ä–æ—Å –∑–∞ –≤–æ–ø—Ä–æ—Å.", control: -10, bond: +15, next: 'main_07', reaction: 'exchange', scene_variant: 'exchange' },
                { text: "–Ø –æ—Å—Ç–∞—é—Å—å –≤ —Ä–∞–º–∫–∞—Ö. –ù–æ –º–æ–∂–µ—à—å —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å ‚Äî —è —Ä–µ—à—É, –æ—Ç–≤–µ—á–∞—Ç—å –ª–∏.", control: +10, bond: +5, next: 'main_07', reaction: 'frame', scene_variant: 'frame' },
                { text: "–ü—Ä–∏–Ω–∏–º–∞—é. –ù–æ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –º–æ–π ‚Äî –ø—Ä–æ –±—É–º–∞–∂–∫—É.", control: +5, bond: +15, next: 'branch_C', branch: true, lock: { bond_min: 50, lock_text: "–û–Ω –≤–∞–º –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç" } },
                { text: "–ù–µ—Ç. –¢—ã –Ω–µ —Å—Ç–∞–≤–∏—à—å —É—Å–ª–æ–≤–∏—è. –Ø ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç. –¢—ã ‚Äî –ø–∞—Ü–∏–µ–Ω—Ç.", control: +15, bond: -15, next: 'main_07', reaction: 'refuse', scene_variant: 'refuse' }
            ],
            reactions: {
                exchange: null,
                frame: null,
                refuse: null
            }
        },

        // === –í–ï–¢–ö–ê –í ===
        branch_C: {
            scene: `‚Äî –ë—É–º–∞–∂–∫–∞... (–∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞, –≤–ø–µ—Ä–≤—ã–µ –∑–∞ —Å–µ—Å—Å–∏—é) –Ø –≥–æ–≤–æ—Ä–∏–ª —ç—Ç–æ —Å–ª–æ–≤–æ –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö. –í –∫–æ–Ω—Ü–µ. –ö–æ–≥–¥–∞ –º–∞—Å–∫–∏ —É–∂–µ –Ω–µ –±—ã–ª–æ. –ö–æ–≥–¥–∞ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ª–∏—Ü–æ. (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞) –ù–∏ –æ–¥–Ω–∞ –Ω–µ —É—Å–ª—ã—à–∞–ª–∞. –û–Ω–∏ —Å–ª—ã—à–∞–ª–∏ –¥–∏–∞–≥–Ω–æ–∑. –°–ª—ã—à–∞–ª–∏ —É–≥—Ä–æ–∑—É. –°–ª—ã—à–∞–ª–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–µ —Å–ª–æ–≤–æ.\n\n(—Ç–∏—à–µ) –¢–æ–≥–¥–∞ —è –∑–∞–ø–∏—Å–∞–ª –µ–≥–æ. –î–ª—è —Ç–æ–π, –∫—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç. –ö—Ç–æ –Ω–µ –±—É–¥–µ—Ç –ø–æ–¥–±–∏—Ä–∞—Ç—å –∫ –Ω–µ–º—É —è—Ä–ª—ã–∫. (—Å–º–æ—Ç—Ä–∏—Ç –ø—Ä—è–º–æ –Ω–∞ —Ç–µ–±—è) –¢—ã –ø–æ–∫–∞ –Ω–µ –º–æ–∂–µ—à—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—â—ë –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—à—å. –ù–æ –∫ –∫–æ–Ω—Ü—É ‚Äî –ø–æ—á—É–≤—Å—Ç–≤—É–µ—à—å. –ï—Å–ª–∏ –æ—Å—Ç–∞–Ω–µ—à—å—Å—è.`,
            choices: [
                { text: "–û—Å—Ç–∞–Ω—É—Å—å. –î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å.", control: -5, bond: +15, next: 'main_07', warn: true, scene_variant: 'exchange' },
                { text: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç ¬´–µ—Å–ª–∏ –æ—Å—Ç–∞–Ω—É—Å—å¬ª? –≠—Ç–æ —É–≥—Ä–æ–∑–∞?", control: +10, bond: -5, next: 'main_07', scene_variant: 'frame' },
                { text: "–û–¥–Ω–æ —Å–ª–æ–≤–æ. –®–µ—Å—Ç—å –±—É–∫–≤.", control: +5, bond: +10, next: 'main_07', clue: true, clue_text: `¬´–Ø –ø–∏—Å–∞–ª –Ω–æ—á—å—é. –ë–µ–∑ —Å–≤–µ—Ç–∞. –ü–æ –ø–∞–º—è—Ç–∏. –†—É–∫–∏ –ø–æ–º–Ω—è—Ç –¥–≤–∏–∂–µ–Ω–∏–µ, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–∏—à—å. –ö–∞–∫ —Ç–µ–ª–æ –ø–æ–º–Ω–∏—Ç –æ–±—ä—è—Ç–∏–µ. –ò–ª–∏ —É–¥–∞—Ä.¬ª`, scene_variant: 'exchange' }
            ]
        },

        // === –≠–¢–ê–ü 7 ‚Äî –ï–ì–û –í–û–ü–†–û–° ===
        main_07: {
            scene_variants: {
                exchange: `‚Äî –ú–æ–π –≤–æ–ø—Ä–æ—Å. (–ø—Ä—è–º–æ, –±–µ–∑ –∏–≥—Ä—ã) –ö–æ–≥–¥–∞ —Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞, —á—Ç–æ —Ç–µ–±—è –≤–∏–¥—è—Ç? –ù–µ ¬´–ø–æ–Ω–∏–º–∞—é—Ç¬ª, –Ω–µ ¬´—Å–ª—ã—à–∞—Ç¬ª ‚Äî –∏–º–µ–Ω–Ω–æ –≤–∏–¥—è—Ç. –ù–∞—Å–∫–≤–æ–∑—å. –ë–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–ø—Ä—è—Ç–∞—Ç—å—Å—è.`,
                frame: `‚Äî –ù–µ –æ–±—è–∑–∞–Ω–∞ –æ—Ç–≤–µ—á–∞—Ç—å. –ù–æ. –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤–∏–¥–µ–ª —Ç–µ–±—è –Ω–∞—Å—Ç–æ—è—â—É—é? –ù–µ –¥–æ–∫—Ç–æ—Ä–∞ ‚Äî —Ç–µ–±—è.`,
                refuse: `‚Äî (–∫–∏–≤–∞–µ—Ç, —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ, –Ω–æ –≤ –≥–ª–∞–∑–∞—Ö ‚Äî —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, —Ö–æ–ª–æ–¥–Ω–æ–µ) –•–æ—Ä–æ—à–æ. –¢–æ–≥–¥–∞ –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å, –±–µ–∑ –æ–±–º–µ–Ω–∞. –¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –±–æ—è–ª–∞—Å—å, —á—Ç–æ —Ç—ã ‚Äî –Ω–µ –Ω–∞ —Ç–æ–π —Å—Ç–æ—Ä–æ–Ω–µ —Å—Ç–µ–∫–ª–∞?`
            },
            choices: [
                { text: "–≠—Ç–æ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è.", control: +10, bond: -10, next: 'main_08' },
                { text: "–î–∞–≤–Ω–æ. –°–ª–∏—à–∫–æ–º –¥–∞–≤–Ω–æ. –ú–æ–∂–µ—Ç –±—ã—Ç—å ‚Äî –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.", control: -10, bond: +15, next: 'main_08' },
                { text: "–¢—ã. –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å. –¢—ã –≤–∏–¥–∏—à—å –º–µ–Ω—è —Ç–∞–∫, –∫–∞–∫ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–µ–ª.", control: -15, bond: +20, next: 'main_08', lock: { bond_min: 60 }, danger: true },
                { text: "–û—Ç–≤–µ—á—É, –µ—Å–ª–∏ —Ç—ã –æ—Ç–≤–µ—Ç–∏—à—å –ø–µ—Ä–≤—ã–º.", control: +10, bond: +10, next: 'branch_D', branch: true }
            ]
        },

        // === –í–ï–¢–ö–ê –ì ===
        branch_D: {
            scene: `‚Äî –ö–∞–∂–¥—ã–π, –∫—Ç–æ —Å–∞–¥–∏–ª—Å—è –Ω–∞ —Ç–≤–æ—ë –º–µ—Å—Ç–æ, –¥—É–º–∞–ª, —á—Ç–æ –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã. –ê –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ ‚Äî –æ—Ç–≤–µ—á–∞–ª. –ù–∞ –º–æ–∏. –ü—Ä–æ—Å—Ç–æ –Ω–µ –∑–∞–º–µ—á–∞–ª.`,
            choices: [
                { text: "–ö—Ä–∞—Å–∏–≤–∞—è —Ç–µ–æ—Ä–∏—è. –ù–æ —Ç—ã ‚Äî –∑–∞ —Å—Ç–µ–∫–ª–æ–º. –ê —è —É—Ö–æ–∂—É –¥–æ–º–æ–π.", control: +10, bond: -5, next: 'main_08' },
                { text: "–ú–æ–∂–µ—Ç –±—ã—Ç—å. –ù–æ —Ç–æ–≥–¥–∞ ‚Äî –∫–∞–∫–æ–π –º–æ–π –¥–∏–∞–≥–Ω–æ–∑, –¥–æ–∫—Ç–æ—Ä?", control: -5, bond: +15, next: 'main_08', clue: true, clue_text: `¬´–ë—ã–ª –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫. –î–∞–≤–Ω–æ. –†–∞–∑–±–∏–ª —á—Ç–æ-—Ç–æ ‚Äî –Ω–µ –ø–æ–º–Ω—é —á—Ç–æ. –ú–µ–ª–æ—á—å. –ò —Å–∫–∞–∑–∞–ª –º–Ω–µ –¥–≤–∞ —Å–ª–æ–≤–∞. –¢–∏—Ö–æ, –ø—Ä–æ—Å—Ç–æ. –ö–∞–∫ –¥—ã—à–∞—Ç. –Ø —Ç–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω—è–ª, –ø–æ—á–µ–º—É –∑–∞–ø–æ–º–Ω–∏–ª. –¢–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞—é ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –±–æ–ª—å—à–µ –Ω–∏–∫—Ç–æ. –ù–∏–∫–æ–≥–¥–∞.¬ª` },
                { text: "–ü—Ä–µ–ø–∞—Ä–∏—Ä—É–µ—à—å. –î–æ–ø—É—Å—Ç–∏–º. –ò —á—Ç–æ —Ç—ã –Ω–∞—à—ë–ª –≤–Ω—É—Ç—Ä–∏?", control: 0, bond: +15, next: 'main_08', warn: true, clue: true, clue_text: `¬´–ë—ã–ª –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫. –î–∞–≤–Ω–æ. –†–∞–∑–±–∏–ª —á—Ç–æ-—Ç–æ ‚Äî –Ω–µ –ø–æ–º–Ω—é —á—Ç–æ. –ú–µ–ª–æ—á—å. –ò —Å–∫–∞–∑–∞–ª –º–Ω–µ –¥–≤–∞ —Å–ª–æ–≤–∞. –¢–∏—Ö–æ, –ø—Ä–æ—Å—Ç–æ. –ö–∞–∫ –¥—ã—à–∞—Ç. –Ø —Ç–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω—è–ª, –ø–æ—á–µ–º—É –∑–∞–ø–æ–º–Ω–∏–ª. –¢–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞—é ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –±–æ–ª—å—à–µ –Ω–∏–∫—Ç–æ. –ù–∏–∫–æ–≥–¥–∞.¬ª` }
            ]
        },

        // === –≠–¢–ê–ü 8 ‚Äî –û–ù –ó–ù–ê–ï–¢ ===
        main_08: {
            scene: `–ü—è—Ç—å–¥–µ—Å—è—Ç –º–∏–Ω—É—Ç. –û–Ω –æ–ø—É—Å–∫–∞–µ—Ç –≥–æ–ª–æ–≤—É, –ø–æ—Ç–æ–º –ø–æ–¥–Ω–∏–º–∞–µ—Ç. –í–∑–≥–ª—è–¥ –¥—Ä—É–≥–æ–π. –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π. –ò —Å—Ç—Ä–∞—à–Ω—ã–π.\n\n‚Äî –°—Ä–µ–¥–∞. ¬´–ë—é—Ä–æ¬ª. –ö–∞–ø—É—á–∏–Ω–æ —Å –∫–æ—Ä–∏—Ü–µ–π. –°—Ç–æ–ª–∏–∫ —É –æ–∫–Ω–∞. –ü–æ—Ç–æ–º –≤ –∏–¥–µ–∞–ª–µ —Ç–∞—Ä—Ç–∞—Ä, –∫—Ä–∞—Å–Ω–æ–µ. –¢—ã –µ—à—å –º–µ–¥–ª–µ–Ω–Ω–æ. –£—Ö–æ–¥–∏—à—å –Ω–µ —Å—Ä–∞–∑—É. –ì—É–ª—è–µ—à—å. –ü–∞—Ä–∫ –ë–∞—É–º–∞–Ω–∞. –ü–æ—Ç–æ–º ‚Äî –º–µ—Ç—Ä–æ.\n\n(—Ç–∏—à–∏–Ω–∞)\n\n‚Äî –Ø –Ω–µ —Å–ª–µ–¥–∏–ª. –ú–Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∏. –£ —Å—Ç–µ–Ω –µ—Å—Ç—å —É—à–∏. –ê —É –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö —è –∑–Ω–∞–ª –¥–æ —ç—Ç–∏—Ö —Å—Ç–µ–Ω, ‚Äî –ø—Ä–∏–≤—ã—á–∫–∏.\n\n–û–Ω –∑–Ω–∞–µ—Ç, –≥–¥–µ —Ç—ã –æ–±–µ–¥–∞–µ—à—å. –ö–∞–∫ –µ—à—å. –ö—É–¥–∞ –∏–¥—ë—à—å.`,
            choices: [
                { text: "–ö—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞–ª? –ò–º—è. –°–µ–π—á–∞—Å.", control: +15, bond: -15, next: 'main_09' },
                { text: "–ó–∞—á–µ–º —Ç–µ–±–µ —ç—Ç–æ? –ß—Ç–æ —Ç—ã —Å—Ç—Ä–æ–∏—à—å?", control: +5, bond: +10, next: 'main_09' },
                { text: "–¢—ã —Å–æ–±–∏—Ä–∞–ª –¥–∞–Ω–Ω—ã–µ. –ö–∞–∫ —Å —Ç–µ–º–∏ —Ç—Ä–µ–º—è. –Ø ‚Äî —á–µ—Ç–≤—ë—Ä—Ç–∞—è? –¢–∞, –æ—Ç –∫–æ—Ç–æ—Ä–æ–π —Ç—ã –Ω–µ —É—à—ë–ª?", control: +10, bond: +15, next: 'main_09', reaction: 'pattern', lock: { bond_min: 60, lock_text: "–û–Ω –≤–∞–º –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç" }, clue: true, clue_text: `¬´–ë—É–º–∞–∂–∫–∞. –®–µ—Å—Ç—å –±—É–∫–≤. –Ø –≥–æ–≤–æ—Ä–∏–ª —ç—Ç–æ —Å–ª–æ–≤–æ –∫–∞–∂–¥–æ–π. –í –∫–æ–Ω—Ü–µ. –ù–∏ –æ–¥–Ω–∞ –Ω–µ —É—Å–ª—ã—à–∞–ª–∞. –ú–æ–∂–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —è –≥–æ–≤–æ—Ä–∏–ª –µ–≥–æ –Ω–µ —Ç–µ–º –ª—é–¥—è–º.¬ª` },
                { text: "–¢—ã —Ö–æ—á–µ—à—å –Ω–∞–ø—É–≥–∞—Ç—å. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü—Ä–æ–¥–æ–ª–∂–∏–º.", control: +5, bond: 0, next: 'main_09' }
            ],
            reactions: {
                pattern: `–ù–µ—Ç. (–±–µ—Ä—ë—Ç —Å–µ–±—è –≤ —Ä—É–∫–∏) –¢–µ —Ç—Ä–∏ ‚Äî –±—ã–ª–∏ —Å–∏—Å—Ç–µ–º–æ–π. –ö–∞–∂–¥–∞—è –∏–∑ –Ω–∏—Ö —Å—Ç–∞–≤–∏–ª–∞ –¥–∏–∞–≥–Ω–æ–∑ –∫–∞–∫ —Å—Ç–µ–Ω—É. ¬´–í–æ—Ç —Ç—ã ‚Äî —ç—Ç–æ. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è.¬ª –û–Ω–∏ –Ω–µ –ª–µ—á–∏–ª–∏ ‚Äî –æ–Ω–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏. –ö–∞–∫ –ø–æ—á—Ç—É. –ö–æ–Ω–≤–µ—Ä—Ç, —à—Ç–∞–º–ø, –≤ —è—â–∏–∫.\n\n(—Ç–∏—à–µ) –¢—ã ‚Äî –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç. –¢—ã ‚Äî –ø–µ—Ä–≤–∞—è, –∫—Ç–æ —Å–ø—Ä–æ—Å–∏–ª–∞ ¬´–∫—Ç–æ —Ç—ã¬ª –≤–º–µ—Å—Ç–æ ¬´—á—Ç–æ —Å —Ç–æ–±–æ–π¬ª. –¢—ã –Ω–µ –ª–µ–∑–µ—à—å –∑–∞ —è—Ä–ª—ã–∫–æ–º. –¢—ã... —Å–º–æ—Ç—Ä–∏—à—å.\n\n(–µ—â—ë —Ç–∏—à–µ) –≠—Ç–æ –ø—É–≥–∞–µ—Ç –º–µ–Ω—è –±–æ–ª—å—à–µ –ª—é–±–æ–π –∫–∞–º–µ—Ä—ã.`
            }
        },

        // === –≠–¢–ê–ü 9 ‚Äî –ü–†–ò–ó–ù–ê–ù–ò–ï ===
        main_09: {
            scene: `–î–µ—Å—è—Ç—å –º–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞. –°–≤–µ—Ç –º–µ—Ä—Ü–∞–µ—Ç. –ò–ª–∏ —ç—Ç–æ –≥–ª–∞–∑–∞. –û–Ω —Å—Ç–∞–ª —Ç–∏—à–µ ‚Äî –Ω–µ –º–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω–æ. –ü–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É. –ß—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –∏–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, ‚Äî —Å–æ–±—Ä–∞–ª–æ—Å—å.\n\n‚Äî –í—Ä–µ–º—è. –ú–∞–ª–æ. –Ø —Å–∫–∞–∂—É —Ç–æ, —á—Ç–æ –Ω–µ –≥–æ–≤–æ—Ä–∏–ª. –ù–µ –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –ø—Å–∏—Ö–æ–ª–æ–≥. (–ø–∞—É–∑–∞) –ß–µ—Ç–≤—ë—Ä—Ç–∞—è. –¢–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–ø–∞–ª–∞. –Ø —Å—Ç–æ—è–ª –≤ –µ—ë –∫–≤–∞—Ä—Ç–∏—Ä–µ. –ß–∞—Å. –ú–æ–∂–µ—Ç –±–æ–ª—å—à–µ. –°–º–æ—Ç—Ä–µ–ª. –û–Ω–∞ –¥—ã—à–∞–ª–∞. –†–æ–≤–Ω–æ. –°–ø–æ–∫–æ–π–Ω–æ. –ö–∞–∫ –±—É–¥—Ç–æ –º–∏—Ä –±–µ–∑–æ–ø–∞—Å–µ–Ω. –ö–∞–∫ –±—É–¥—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ —Å—Ç–æ–∏—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ.\n\n(–≥–æ–ª–æ—Å –Ω–∞—á–∏–Ω–∞–µ—Ç –¥—Ä–æ–∂–∞—Ç—å ‚Äî –≤–ø–µ—Ä–≤—ã–µ –∑–∞ –≤—Å—é —Å–µ—Å—Å–∏—é)\n\n‚Äî –Ø –ø–æ–¥–Ω—è–ª —Ä—É–∫–∏. –ò –Ω–µ –º–æ–≥. –ù–µ –º–æ–≥. –ü–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ –±—ã–ª–∞... (–∏—â–µ—Ç —Å–ª–æ–≤–æ) ...–Ω–∞—Å—Ç–æ—è—â–∞—è. –í–æ —Å–Ω–µ ‚Äî –Ω–∞—Å—Ç–æ—è—â–∞—è. –ë–µ–∑ –º–∞—Å–æ–∫. –ë–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è. –û–Ω–∞ –Ω–µ –ø—Ä–∏—Ç–≤–æ—Ä—è–ª–∞—Å—å. –ò —è –ø–æ–Ω—è–ª: –µ—Å–ª–∏ —è –∫–æ—Å–Ω—É—Å—å –µ—ë ‚Äî —è —É–Ω–∏—á—Ç–æ–∂—É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ, —á—Ç–æ –≤–∏–¥–µ–ª.`,
            choices: [
                { text: "–ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–ª –ø–æ—Ç–æ–º?", control: +5, bond: +10, next: 'main_10' },
                { text: "–¢—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è. –ó–Ω–∞—á–∏—Ç, –≤ —Ç–µ–±–µ –µ—Å—Ç—å —Ç–æ, —á—Ç–æ —Å–∏–ª—å–Ω–µ–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞.", control: 0, bond: +15, next: 'main_10' },
                { text: "–°–ª–æ–≤–æ –Ω–∞ –±—É–º–∞–∂–∫–µ ‚Äî —Ç—ã –≥–æ–≤–æ—Ä–∏–ª –µ–≥–æ –∏–º. –í—Å–µ–º —Ç—Ä—ë–º. –ß—Ç–æ —ç—Ç–æ –∑–∞ —Å–ª–æ–≤–æ?", control: +5, bond: +15, next: 'branch_E', branch: true },
                { text: "–ß–µ—Ç–≤—ë—Ä—Ç–∞—è ‚Äî –Ω–µ—Ä–∞—Å–∫—Ä—ã—Ç–æ–µ –¥–µ–ª–æ. –¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ?", control: +15, bond: -10, next: 'main_10' }
            ]
        },

        // === –í–ï–¢–ö–ê –î ===
        branch_E: {
            scene: `‚Äî (–∑–∞–º–∏—Ä–∞–µ—Ç, –≥–ª–∞–∑–∞ –±–ª–µ—Å—Ç—è—Ç, –Ω–æ –Ω–µ –ø–ª–∞—á–µ—Ç ‚Äî –Ω–µ –º–æ–∂–µ—Ç) –ö–∞–∂–¥–æ–π. –í —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ. –ö–æ–≥–¥–∞ —É–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å. –Ø –≥–æ–≤–æ—Ä–∏–ª —ç—Ç–æ —Å–ª–æ–≤–æ ‚Äî –∞ –æ–Ω–∏ –Ω–µ —Å–ª—ã—à–∞–ª–∏. –°–ª—ã—à–∞–ª–∏ –ª–æ–∂—å, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—é, –ª–æ–≤—É—à–∫—É. –ß—Ç–æ —É–≥–æ–¥–Ω–æ. (–Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç)\n\n(–¥–æ–ª–≥–∞—è –ø–∞—É–∑–∞) –®–µ—Å—Ç—å –±—É–∫–≤. –°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —Å–ª–æ–≤–æ –Ω–∞ —Å–≤–µ—Ç–µ. –Ø –∑–∞–ø–∏—Å–∞–ª –µ–≥–æ ‚Äî –¥–ª—è —Ç–æ–π, –∫—Ç–æ —É—Å–ª—ã—à–∏—Ç –Ω–µ —É—à–∞–º–∏.\n\n(—Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–µ–±—è) –¢—ã –∑–Ω–∞–µ—à—å –∫–∞–∫–æ–µ. –¢—ã —É–∂–µ –∑–Ω–∞–µ—à—å.`,
            choices: [
                { text: "–ó–Ω–∞—é.", control: -5, bond: +15, next: 'main_10' },
                { text: "–°–∫–∞–∂–∏ –µ–≥–æ. –í—Å–ª—É—Ö.", control: +5, bond: +10, next: 'main_10' },
                { text: "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–≤–∞ –Ω–µ–ª—å–∑—è —Å–∫–∞–∑–∞—Ç—å. –¢–æ–ª—å–∫–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ —Ç–µ–º–Ω–æ—Ç–µ.", control: 0, bond: +15, next: 'main_10' }
            ]
        },

        // === –≠–¢–ê–ü 10 ‚Äî –§–ò–ù–ê–õ ===
        main_10: {
            scene: `–ú–∏–Ω—É—Ç–∞. –ö—Ä–∞—Å–Ω—ã–π –æ–≥–æ–Ω—ë–∫ –∫–∞–º–µ—Ä—ã –º–∏–≥–∞–µ—Ç ‚Äî —Å–∫–æ—Ä–æ –∑–∞–π–¥—É—Ç. –û–Ω —Å—Ç–æ–∏—Ç. –ù–µ —É–≥—Ä–æ–∂–∞—é—â–µ. –ö–∞–∫ —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–≥–æ –Ω—ë—Å —á—Ç–æ-—Ç–æ –∏ –Ω–∞–∫–æ–Ω–µ—Ü –º–æ–∂–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å.\n\n–û–Ω –∫–ª–∞–¥—ë—Ç –ª–∞–¥–æ–Ω—å –Ω–∞ —Å—Ç–µ–∫–ª–æ. –ù–µ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ ‚Äî –¥–ª—è —Å–µ–±—è. –ß—Ç–æ–±—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—É, –∫–æ—Ç–æ—Ä–∞—è –≤—Å—ë –µ—â—ë —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.\n\n‚Äî –¢—ã –æ—Å—Ç–∞–ª–∞—Å—å. (—Ç–∏—Ö–æ) –¢—ã –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∞ –º–Ω–µ –Ω–∏ –æ–¥–Ω–æ–≥–æ —à—Ç–∞–º–ø–∞ –∑–∞ —á–∞—Å. –ù–∏ –æ–¥–Ω–æ–≥–æ.\n\n(–ø–∞—É–∑–∞) –ë—É–º–∞–∂–∫–∞. –û–Ω–∞ —Ç–≤–æ—è. –¢—ã ‚Äî —Ç–∞, –∫–æ–º—É —è –º–æ–≥—É –µ—ë –æ—Ç–¥–∞—Ç—å. –ü–æ—Å–º–æ—Ç—Ä–∏.`,
            choices: [
                { text: "(–î–æ—Å—Ç–∞—ë—à—å –±—É–º–∞–∂–∫—É. –ü–æ–¥–Ω–æ—Å–∏—à—å –∫ —Å–≤–µ—Ç—É. –ë—É–∫–≤—ã –ø—Ä–æ—Å—Ç—É–ø–∞—é—Ç.)", control: 0, bond: 0, next: 'victory' },
                { text: "(–¢—ã —É–∂–µ –∑–Ω–∞–µ—à—å, —á—Ç–æ —Ç–∞–º. –ù–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–º–æ—Ç—Ä–∏—à—å.)", control: 0, bond: 0, next: 'victory' },
                { text: "(–†–∞–∑–≥–ª–∞–∂–∏–≤–∞–µ—à—å –±—É–º–∞–∂–∫—É –Ω–∞ —Å—Ç–æ–ª–µ. –ê–∫–∫—É—Ä–∞—Ç–Ω–æ. –ö–∞–∫ —Ö—Ä—É–ø–∫—É—é –≤–µ—â—å.)", control: 0, bond: 0, next: 'victory' },
                { text: "–Ø –∑–Ω–∞—é, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ. –ù–µ –Ω—É–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å.", control: 0, bond: 0, next: 'victory' }
            ]
        },

        // === –ü–û–ë–ï–î–ê ===
        victory: {
            isVictory: true
        },

        // === –ì–ï–ô–ú-–û–í–ï–†–´ ===
        gameover_control: {
            scene: `–¢—ã –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∞, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã. –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—á–∞—Ç—å. –ö–æ–≥–¥–∞ –µ–≥–æ –≥–æ–ª–æ—Å —Å—Ç–∞–ª –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º –≤ –∫–æ–º–Ω–∞—Ç–µ.\n\n–û–Ω –≥–æ–≤–æ—Ä–∏—Ç ‚Äî —Ç—ã —Å–ª—É—à–∞–µ—à—å. –û–Ω —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç ‚Äî —Ç—ã –æ—Ç–≤–µ—á–∞–µ—à—å. –ë–ª–æ–∫–Ω–æ—Ç –¥–∞–≤–Ω–æ –Ω–∞ –ø–æ–ª—É. –†—É–∫–∏ –Ω–∞ –∫–æ–ª–µ–Ω—è—Ö. –ö–æ–ª—å—Ü–æ —Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —Ç—Ä–æ–≥–∞—Ç—å ‚Äî –æ–Ω–æ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç.\n\n‚Äî (—Ç–∏—Ö–æ, –∫–∞–∫ –∫–æ–ª—ã–±–µ–ª—å–Ω—É—é) –í–æ—Ç –∏ –≤—Å—ë. –í–∏–¥–∏—à—å, –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ? –¢—ã –ø—Ä–∏—à–ª–∞ –ª–µ—á–∏—Ç—å ‚Äî –∏ –∑–∞–±—ã–ª–∞, —á—Ç–æ —Ç—ã –≤—Ä–∞—á. –¢—ã –ø—Ä–∏—à–ª–∞ –Ω–∞–±–ª—é–¥–∞—Ç—å ‚Äî –∏ —Å—Ç–∞–ª–∞ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π.\n\n(–Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è –∫ —Å—Ç–µ–∫–ª—É) –û–Ω–∏ –≤—Å–µ —Ç–∞–∫. –ù–∞—á–∏–Ω–∞—é—Ç —Å–∏–ª—å–Ω—ã–º–∏. –ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç ‚Äî –≤ –º–æ–µ–π –∫–æ–º–Ω–∞—Ç–µ. –ù–µ –≤ —ç—Ç–æ–π. –í —Ç–æ–π, —á—Ç–æ –≤ –≥–æ–ª–æ–≤–µ.\n\n(—É–ª—ã–±–∞–µ—Ç—Å—è) –°—Ä–µ–¥–∞. ¬´–ë—é—Ä–æ¬ª. –°—Ç–æ–ª–∏–∫ —É –æ–∫–Ω–∞. –¢—ã –ø—Ä–∏–¥—ë—à—å. –°—è–¥–µ—à—å —Å–ø–∏–Ω–æ–π –∫ –¥–≤–µ—Ä–∏. –ö–∞–∫ –≤—Å–µ–≥–¥–∞.\n\n–¢—ã —Ö–æ—á–µ—à—å —Å–∫–∞–∑–∞—Ç—å ¬´–Ω–µ—Ç¬ª ‚Äî –Ω–æ –Ω–µ –º–æ–∂–µ—à—å –≤—Å–ø–æ–º–Ω–∏—Ç—å, –ø–æ—á–µ–º—É. –î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –û—Ö—Ä–∞–Ω–∞. –¢—ã –≤—Å—Ç–∞—ë—à—å. –í—ã—Ö–æ–¥–∏—à—å.`,
            screen: "–û–Ω —Ç–∞–∫ –∏ –Ω–µ –æ—Ç–¥–∞–ª –±—É–º–∞–∂–∫—É. –¢—ã –Ω–µ —Å—Ç–∞–ª–∞ —Ç–æ–π, –∫–æ–º—É –æ–Ω –º–æ–≥ –µ—ë –¥–æ–≤–µ—Ä–∏—Ç—å.",
            isGameOver: true,
            post_credits: true
        },

        gameover_bond: {
            scene: `–û–Ω –≤—Å—Ç–∞—ë—Ç. –ú–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ —Å—Ç–µ–∫–ª—É. –ö–ª–∞–¥—ë—Ç –ª–∞–¥–æ–Ω—å.\n\n–¢—ã ‚Äî –Ω–µ –æ—Ç–≤–æ–¥–∏—à—å –≤–∑–≥–ª—è–¥. –†—É–∫–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —Å–∞–º–∞ ‚Äî –ª–∞–¥–æ–Ω—å –∫ –ª–∞–¥–æ–Ω–∏, —Å—Ç–µ–∫–ª–æ –º–µ–∂–¥—É. –¢—ë–ø–ª–æ–µ. –ò–ª–∏ —Ç–µ–±–µ –∫–∞–∂–µ—Ç—Å—è.\n\n‚Äî (—à—ë–ø–æ—Ç) –¢—ã –≤–∏–¥–∏—à—å? –°—Ç–µ–∫–ª–∞ –Ω–µ—Ç. –ï–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ. –≠—Ç–æ –º—ã –µ–≥–æ –ø—Ä–∏–¥—É–º–∞–ª–∏ ‚Äî —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—â–µ. –ù–æ –º–µ–∂–¥—É –Ω–∞–º–∏ ‚Äî –Ω–∏—á–µ–≥–æ. –ü—É—Å—Ç–æ. –í–æ–∑–¥—É—Ö.\n\n–¢—Ä–∏ —Å–µ–∫—É–Ω–¥—ã —Ç–∏—à–∏–Ω—ã. –î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –û—Ö—Ä–∞–Ω–∞. –î–≤–æ–µ. ¬´–î–æ–∫—Ç–æ—Ä, –ø—Ä–æ–π–¥—ë–º—Ç–µ. –°–µ–π—á–∞—Å.¬ª\n\n–û–Ω —à–µ–ø—á–µ—Ç –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω: ¬´–°—Ä–µ–¥–∞. –Ø –∑–Ω–∞—é.¬ª\n\n–¢—ã –≤—ã—Ö–æ–¥–∏—à—å. –ù–æ–≥–∏ –≤–∞—Ç–Ω—ã–µ. –ë—É–º–∞–∂–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å —É –Ω–µ–≥–æ. –û–Ω –Ω–µ –æ—Ç–¥–∞–ª. –¢—ã –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ ‚Äî –∏ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.`,
            screen: "–û–Ω –Ω–µ –æ—Ç–¥–∞–ª –±—É–º–∞–∂–∫—É. –¢—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ‚Äî –Ω–æ –Ω–µ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ.",
            isGameOver: true,
            post_credits: true
        },

        gameover_combo: {
            scene: `–ö–∞–º–µ—Ä–∞ –≤ —É–≥–ª—É —Å–Ω–∏–º–∞–µ—Ç: –æ–±—ä–µ–∫—Ç –≥–æ–≤–æ—Ä–∏—Ç ‚Äî –¥–æ–∫—Ç–æ—Ä —Å–ª—É—à–∞–µ—Ç. –ù–µ –Ω–∞–æ–±–æ—Ä–æ—Ç. –û–±—ä–µ–∫—Ç –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –¥–æ–∫—Ç–æ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç. –û–±—ä–µ–∫—Ç –Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è –≤–ø–µ—Ä—ë–¥ ‚Äî –¥–æ–∫—Ç–æ—Ä –æ—Ç–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥.\n\n–ó–∞ —Å—Ç–µ–∫–ª–æ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è ‚Äî —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ç—Ä—É–±–∫—É.\n\n¬´–ü—Ä–µ—Ä–≤–∏—Ç–µ. –û–Ω–∞ –Ω–µ –≤–µ–¥—ë—Ç —Å–µ—Å—Å–∏—é. –û–Ω–∞ –≤ —Å–µ—Å—Å–∏–∏.¬ª\n\n–î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –¢–µ–±—è –≤—ã–≤–æ–¥—è—Ç. –û–Ω —Å–º–æ—Ç—Ä–∏—Ç –≤—Å–ª–µ–¥. –°–ø–æ–∫–æ–π–Ω–æ.\n\n‚Äî (—Ç–∏—Ö–æ, —Å–∞–º–æ–º—É —Å–µ–±–µ) –≠—Ç–∞... –Ω–µ –ø–æ–ª—É—á–∏–ª–∞—Å—å. (–ø–∞—É–∑–∞) –°–ª–µ–¥—É—é—â–∞—è ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏–º.\n\n–í –∫–æ—Ä–∏–¥–æ—Ä–µ —Ç—ã –ø—Ä–æ—Ö–æ–¥–∏—à—å –º–∏–º–æ –∑–µ—Ä–∫–∞–ª–∞. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å—Å—è. –°–º–æ—Ç—Ä–∏—à—å. –ù–µ —É–∑–Ω–∞—ë—à—å.`,
            screen: "–ë—É–º–∞–∂–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å –ø—Ä–∏ –Ω—ë–º. –®–µ—Å—Ç—å –±—É–∫–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω —Ç–∞–∫ –∏ –Ω–µ –æ—Ç–¥–∞–ª. –¢—ã –Ω–µ —Å—Ç–∞–ª–∞ —Ç–æ–π, –∫–æ–≥–æ –æ–Ω –∂–¥–∞–ª.",
            isGameOver: true,
            post_credits: true
        },

        // === –ü–û–°–¢-–ö–†–ï–î–ò–¢–ù–ê–Ø –°–¶–ï–ù–ê ===
        post_credits: {
            scene: `–°—Ä–µ–¥–∞. ¬´–ë—é—Ä–æ¬ª. –°—Ç–æ–ª–∏–∫ —É –æ–∫–Ω–∞. –¢—ã –∑–∞–∫–∞–∑—ã–≤–∞–µ—à—å –∫–∞–ø—É—á–∏–Ω–æ.\n\n–ó–∞ —Å–æ—Å–µ–¥–Ω–∏–º —Å—Ç–æ–ª–∏–∫–æ–º ‚Äî –º–æ–ª–æ–¥–æ–π —á–µ–ª–æ–≤–µ–∫. –ù–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–µ–±—è. –ß–∏—Ç–∞–µ—Ç –∫–Ω–∏–≥—É. –Æ–Ω–≥, ¬´–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã¬ª.\n\n–¢—ã –∑–∞–º–µ—á–∞–µ—à—å –µ–≥–æ —Ä—É–∫–∏. –ß–∏—Å—Ç—ã–µ, —É—Ö–æ–∂–µ–Ω–Ω—ã–µ. –ù–æ–≥—Ç–∏ –∫–æ—Ä–æ—Ç–∫–æ –ø–æ–¥—Å—Ç—Ä–∏–∂–µ–Ω—ã.\n\n–ù–∞ –ª–µ–≤–æ–π —Ä—É–∫–µ ‚Äî –¥–≤–∞ –±–ª–µ—Å—Ç—è—â–∏—Ö —Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã—Ö –∫–æ–ª—å—Ü–∞.\n\n–¢—ã —Ç—Ä–æ–≥–∞–µ—à—å –∫–æ–ª—å—Ü–æ –Ω–∞ –ø—Ä–∞–≤–æ–π —Ä—É–∫–µ. –ö—Ä–µ—Å—Ç–∏–∫. –°–µ—Ä–µ–±—Ä–æ.\n\n–û–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤–∑–≥–ª—è–¥.\n\n–£–ª—ã–±–∞–µ—Ç—Å—è.`,
            isPostCredits: true
        }
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π scene_variant –¥–ª—è main_07
    let chosenSceneVariant = 'exchange';

    // ==========================================
    // –¢–ê–ô–ú–ï–† –ö–ê–ú–ï–†–´
    // ==========================================
    function updateCamTime() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');
        const el = document.getElementById('cam-time');
        if (el) el.textContent = `${h}:${m}:${s}`;
    }
    setInterval(updateCamTime, 1000);
    updateCamTime();

    // ==========================================
    // –ì–õ–ò–¢–ß-–≠–§–§–ï–ö–¢–´
    // ==========================================
    function getGlitchLevel() {
        // –£—Ä–æ–≤–µ–Ω—å –≥–ª–∏—Ç—á–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ control –∏ bond
        // 0 = –Ω–µ—Ç, 1 = –ª—ë–≥–∫–∏–π, 2 = —Å—Ä–µ–¥–Ω–∏–π, 3 = —Å–∏–ª—å–Ω—ã–π, 4 = –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π
        if (control <= 20 && bond >= 80) return 4;  // combo danger zone
        if (control <= 20 || bond >= 90) return 3;   // –æ–¥–Ω–∞ —à–∫–∞–ª–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞
        if (control <= 35 || bond >= 75) return 2;   // —Ç—Ä–µ–≤–æ–∂–Ω–æ
        if (control <= 50 || bond >= 60) return 1;   // –Ω–∞—á–∞–ª–æ
        return 0;
    }

    function triggerGlitchBar() {
        const bar = document.getElementById('glitch-bar');
        if (!bar) return;
        const level = getGlitchLevel();
        bar.className = 'glitch-bar';
        if (level >= 4) bar.classList.add('critical');
        else if (level >= 3) bar.classList.add('heavy');

        bar.style.display = 'block';
        bar.style.top = Math.random() * 100 + '%';

        // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è
        const duration = level >= 3 ? (200 + Math.random() * 400) : (80 + Math.random() * 200);
        setTimeout(() => { bar.style.display = 'none'; }, duration);

        // –ù–∞ –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–æ—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        if (level >= 3 && Math.random() > 0.5) {
            setTimeout(() => {
                bar.style.display = 'block';
                bar.style.top = Math.random() * 100 + '%';
                setTimeout(() => { bar.style.display = 'none'; }, 100 + Math.random() * 150);
            }, 100);
        }
    }

    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –≥–ª–∏—Ç—á–∏ ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è
    setInterval(() => {
        const level = getGlitchLevel();
        if (level >= 1) {
            triggerGlitchBar();
            // –ù–∞ –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö ‚Äî —á–∞—â–µ
            if (level >= 3 && Math.random() > 0.3) {
                setTimeout(triggerGlitchBar, 300 + Math.random() * 500);
            }
            if (level >= 4) {
                setTimeout(triggerGlitchBar, 800 + Math.random() * 400);
            }
        }
    }, 1500 + Math.random() * 2000);

    function applyGlitchEffects() {
        const allGlitchClasses = ['glitch-light', 'glitch-text', 'glitch-heavy', 'glitch-critical', 'glitch-color'];
        const decayClasses = ['text-decay-1', 'text-decay-2', 'text-decay-3', 'text-decay-4'];

        // –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –º–∞–Ω—å—è–∫–∞
        const allMsgs = document.querySelectorAll('.msg.object-speech, .msg.reaction-text');
        allMsgs.forEach(msg => {
            allGlitchClasses.forEach(c => msg.classList.remove(c));
            decayClasses.forEach(c => msg.classList.remove(c));
        });

        const level = getGlitchLevel();

        // –û–±–Ω–æ–≤–ª—è–µ–º —à—É–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        updateNoiseOverlay(level);

        // Heartbeat –Ω–∞ —Ä–∞–º–∫–µ
        const gw = document.getElementById('game-window');
        gw.classList.remove('heartbeat-1', 'heartbeat-2', 'heartbeat-3', 'heartbeat-4');
        if (level >= 1) gw.classList.add('heartbeat-' + Math.min(level, 4));

        // –î—ã—Ö–∞–Ω–∏–µ —Ñ–æ—Ç–æ
        const si = document.getElementById('state-image');
        si.classList.remove('breathe-1', 'breathe-2', 'breathe-3', 'breathe-4');
        if (level >= 1) si.classList.add('breathe-' + Math.min(level, 4));

        if (level === 0) return;

        if (level >= 4) {
            // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô: –≤—Å—ë —Ä–∞—Å–ø–∞–¥–∞–µ—Ç—Å—è + —Ü–≤–µ—Ç + —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–ª–∑–∞–µ—Ç—Å—è
            allMsgs.forEach(msg => {
                msg.classList.add('glitch-critical', 'glitch-color', 'text-decay-4');
            });
        } else if (level >= 3) {
            // –°–ò–õ–¨–ù–´–ô: —Ç—Ä—è—Å–∫–∞ + —Ü–≤–µ—Ç + —Ä–∞—Å–ø–æ–ª–∑–∞–Ω–∏–µ
            allMsgs.forEach(msg => {
                msg.classList.add('glitch-heavy', 'text-decay-3');
            });
            const last = allMsgs[allMsgs.length - 1];
            if (last) last.classList.add('glitch-color');
        } else if (level >= 2) {
            // –°–†–ï–î–ù–ò–ô: —Ç—Ä—è—Å–∫–∞ + –Ω–∞—á–∞–ª–æ —Ä–∞—Å–ø–æ–ª–∑–∞–Ω–∏—è
            allMsgs.forEach(msg => {
                msg.classList.add('glitch-text', 'text-decay-2');
            });
        } else if (level >= 1) {
            // –õ–Å–ì–ö–ò–ô: –¥—Ä–æ–∂–∞–Ω–∏–µ + –ª—ë–≥–∫–æ–µ —Ä–∞—Å–ø–æ–ª–∑–∞–Ω–∏–µ
            const recent = Array.from(allMsgs).slice(-3);
            recent.forEach(msg => {
                msg.classList.add('glitch-light', 'text-decay-1');
            });
        }
    }

    // ==========================================
    // –í–ò–ó–£–ê–õ–¨–ù–´–ô –®–£–ú –ò –ü–û–ú–ï–•–ò
    // ==========================================

    // –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —à—É–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function updateNoiseOverlay(level) {
        const noise = document.getElementById('noise-overlay');
        if (!noise) return;
        noise.className = 'noise-overlay';
        if (level >= 4) noise.classList.add('level-4');
        else if (level >= 3) noise.classList.add('level-3');
        else if (level >= 2) noise.classList.add('level-2');
        else if (level >= 1) noise.classList.add('level-1');
    }

    // –í—Å–ø—ã—à–∫–∞ –ø–æ–º–µ—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–≤—è–∑–∏
    function triggerScreenFlash(heavy) {
        const flash = document.getElementById('screen-flash');
        if (!flash) return;
        flash.className = 'screen-flash';
        // Force reflow
        void flash.offsetWidth;
        flash.classList.add(heavy ? 'heavy-flash' : 'active');
        setTimeout(() => { flash.className = 'screen-flash'; }, heavy ? 600 : 400);
    }

    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–º–µ—Ö–∞
    function triggerVGlitch() {
        const vg = document.getElementById('v-glitch');
        if (!vg) return;
        vg.style.left = Math.random() * 100 + '%';
        vg.className = 'v-glitch';
        void vg.offsetWidth;
        vg.classList.add('active');
        setTimeout(() => { vg.className = 'v-glitch'; }, 300);
    }

    // –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø–æ–º–µ—Ö–∞ ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–æ–≤
    let prevBond = 20;
    function triggerStatChangeEffects() {
        const bondDelta = bond - prevBond;
        const level = getGlitchLevel();

        if (bondDelta > 0) {
            // –°–≤—è–∑—å —Ä–∞—Å—Ç—ë—Ç ‚Äî –ø–æ–º–µ—Ö–∏!
            triggerScreenFlash(bondDelta >= 15 || level >= 3);
            triggerGlitchBar();

            // –ü—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ä–æ—Å—Ç–µ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (bondDelta >= 10 || level >= 2) {
                setTimeout(triggerVGlitch, 100);
                setTimeout(triggerGlitchBar, 200);
            }
            if (bondDelta >= 15 || level >= 3) {
                setTimeout(triggerVGlitch, 300);
                setTimeout(triggerGlitchBar, 400);
                setTimeout(triggerVGlitch, 500);
            }
        }

        prevBond = bond;
    }

    // ==========================================
    // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ê–†–û–í –ò –ö–ê–†–¢–ò–ù–ö–ò
    // ==========================================
    function updateBars() {
        document.getElementById('control-bar').style.width = Math.min(Math.max(control, 0), 100) + '%';
        document.getElementById('bond-bar').style.width = Math.min(Math.max(bond, 0), 100) + '%';

        // –¶–≤–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏
        const controlBar = document.getElementById('control-bar');
        if (control <= 20) {
            controlBar.style.background = '#ff0000';
        } else if (control <= 40) {
            controlBar.style.background = '#ff6600';
        } else {
            controlBar.style.background = '';
        }

        // –¶–≤–µ—Ç —Å–≤—è–∑–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏
        const bondBar = document.getElementById('bond-bar');
        if (bond >= 90) {
            bondBar.style.background = '#ff0044';
            bondBar.style.boxShadow = '0 0 10px rgba(255,0,68,0.5)';
        } else if (bond >= 80) {
            bondBar.style.background = '#ff0066';
            bondBar.style.boxShadow = 'none';
        } else {
            bondBar.style.background = '';
            bondBar.style.boxShadow = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ bond
        const img = document.getElementById('state-img');
        let newSrc;
        if (bond < 30) newSrc = 'state_1.png';
        else if (bond < 45) newSrc = 'state_2.png';
        else if (bond < 60) newSrc = 'state_3.png';
        else if (bond < 80) newSrc = 'state_4.png';
        else newSrc = 'state_5.png';

        if (img.src !== newSrc && !img.src.endsWith(newSrc)) {
            img.style.opacity = '0';
            setTimeout(() => {
                img.src = newSrc;
                img.style.opacity = '1';
            }, 400);
        }

        // –°—Ç–∞—Ç—É—Å
        const statusText = document.getElementById('status-text');
        if (control <= 10) statusText.innerHTML = "–°–¢–ê–¢–£–°: <span style='color:#ff0000'>–ü–û–¢–ï–†–Ø –ö–û–ù–¢–†–û–õ–Ø</span>";
        else if (control <= 20 && bond >= 80) statusText.innerHTML = "–°–¢–ê–¢–£–°: <span style='color:#ff0044'>–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–û–ù–ê</span>";
        else if (bond >= 90) statusText.innerHTML = "–°–¢–ê–¢–£–°: <span style='color:#ff00ff'>–û–ü–ê–°–ù–ê–Ø –ë–õ–ò–ó–û–°–¢–¨</span>";
        else if (bond >= 70) statusText.innerHTML = "–°–¢–ê–¢–£–°: <span style='color:#aa44aa'>–í—ã—Å–æ–∫–∞—è —Å–≤—è–∑—å</span>";
        else if (control <= 30) statusText.innerHTML = "–°–¢–ê–¢–£–°: <span style='color:#ff6600'>–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞–¥–∞–µ—Ç</span>";
        else statusText.innerHTML = `–°–¢–ê–¢–£–°: –ù–∞–±–ª—é–¥–µ–Ω–∏–µ... –ö:${control} –°:${bond}`;

        applyGlitchEffects();
        triggerStatChangeEffects();
        updatePsychPanel();
    }

    // ==========================================
    // –ë–õ–û–ö–ù–û–¢ –ü–°–ò–•–û–õ–û–ì–ê + –ì–õ–ê–ó
    // ==========================================

    // –ó–∞–º–µ—Ç–∫–∏ ‚Äî –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ glitchLevel –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≥–ª–∞–∑–æ–º
    // level 0: –∑–∞–º–µ—Ç–∫–∏ 0-1, level 1: 2-3, level 2: 4-5, level 3: 6, level 4: 7
    const notebookNotes = [
        // level 0 ‚Äî —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ
        { text: "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Å–º–æ—Ç—Ä. –æ–Ω –ø—Ä–æ—Å—Ç–æ –ø–∞—Ü–∏–µ–Ω—Ç.", cls: "" },
        { text: "–æ–Ω –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π. —Å–ª–∏—à–∫–æ–º. –∑–∞–ø–∏—Å–∞—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ.", cls: "" },
        // level 1 ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å
        { text: "—Å—Ç—Ä–∞–Ω–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ. –±—É–¥—Ç–æ –æ–Ω –∑–Ω–∞–µ—Ç —á—Ç–æ —è —Å–∫–∞–∂—É.", cls: "note-warm" },
        { text: "–ø–æ–π–º–∞–ª–∞ —Å–µ–±—è –Ω–∞ —Ç–æ–º —á—Ç–æ –∂–¥—É –µ–≥–æ –æ—Ç–≤–µ—Ç–∞. —ç—Ç–æ –Ω–µ–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ.", cls: "note-warm" },
        // level 2 ‚Äî –≤–ª–µ—á–µ–Ω–∏–µ
        { text: "–æ–Ω –≤–∏–¥–∏—Ç –º–µ–Ω—è. –Ω–µ –∫–∞–∫ –≤—Ä–∞—á–∞. –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫–∞. –∏ –º–Ω–µ —ç—Ç–æ...", cls: "note-hot" },
        { text: "–Ω–µ –º–æ–≥—É –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –¥—É–º–∞—Ç—å. —á—Ç–æ –æ–Ω –∏–º–µ–ª –≤ –≤–∏–¥—É?", cls: "note-hot" },
        // level 3 ‚Äî –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å
        { text: "–∫–∞–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –∫–∞–∫–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è. —è —Ö–æ—á—É –ø–æ–Ω—è—Ç—å –µ–≥–æ.", cls: "note-critical" },
        // level 4 ‚Äî –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ
        { text: "–æ–Ω –≤–∏–¥–∏—Ç –º–µ–Ω—è –Ω–∞—Å–∫–≤–æ–∑—å. –æ–Ω –∑–Ω–∞–µ—Ç –∫—Ç–æ —è.", cls: "note-critical" },
    ];

    let currentNoteIdx = 0;
    let prevNoteLevel = 0;

    const eyeStates = [
        { label: "—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ", cls: "", labelCls: "" },
        { label: "–∏–Ω—Ç–µ—Ä–µ—Å", cls: "dilate-1", labelCls: "" },
        { label: "–≤–ª–µ—á–µ–Ω–∏–µ", cls: "dilate-2", labelCls: "warn" },
        { label: "–æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å", cls: "dilate-3", labelCls: "danger" },
        { label: "–ø–æ–≥–ª–æ—â–µ–Ω–∏–µ", cls: "dilate-4", labelCls: "danger" },
    ];

    let eyeBlinkInterval;

    function startEyeBlink() {
        function doBlink() {
            const level = getGlitchLevel();
            const shape = document.getElementById('eye-shape');
            if (shape && !shape.classList.contains('closing')) {
                shape.classList.add('blinking');
                setTimeout(() => shape.classList.remove('blinking'), 200);
            }
            const nextBlink = level >= 3 ? (800 + Math.random() * 1500)
                            : level >= 2 ? (2000 + Math.random() * 3000)
                            : (3000 + Math.random() * 5000);
            eyeBlinkInterval = setTimeout(doBlink, nextBlink);
        }
        eyeBlinkInterval = setTimeout(doBlink, 2000 + Math.random() * 3000);
    }

    function updatePsychPanel() {
        const level = getGlitchLevel();

        // === –ì–õ–ê–ó ===
        const pupil = document.getElementById('eye-pupil');
        const eyeLabel = document.getElementById('eye-label');
        const eyeShape = document.getElementById('eye-shape');

        if (pupil) {
            pupil.classList.remove('dilate-1', 'dilate-2', 'dilate-3', 'dilate-4');
            const state = eyeStates[Math.min(level, eyeStates.length - 1)];
            if (state.cls) pupil.classList.add(state.cls);
        }
        if (eyeLabel) {
            eyeLabel.classList.remove('warn', 'danger');
            const state = eyeStates[Math.min(level, eyeStates.length - 1)];
            eyeLabel.textContent = state.label;
            if (state.labelCls) eyeLabel.classList.add(state.labelCls);
        }
        if (eyeShape) {
            eyeShape.classList.remove('eye-danger');
            if (level >= 3) {
                eyeShape.classList.add('eye-danger');
            } else {
                eyeShape.style.borderColor = level >= 2 ? '#aa5555' : '#444';
            }
        }

        // === –ó–ê–ú–ï–¢–ö–ò (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ glitchLevel) ===
        const nb = document.getElementById('notebook');
        if (!nb) return;

        // –ú–∞–ø–ø–∏–Ω–≥ level ‚Üí –¥–∏–∞–ø–∞–∑–æ–Ω –∑–∞–º–µ—Ç–æ–∫
        // level 0: [0,1], level 1: [2,3], level 2: [4,5], level 3: [6], level 4: [7]
        const levelRanges = [[0,1], [2,3], [4,5], [6,6], [7,7]];
        const range = levelRanges[Math.min(level, 4)];

        // –í–Ω—É—Ç—Ä–∏ —É—Ä–æ–≤–Ω—è ‚Äî –≤—ã–±–∏—Ä–∞–µ–º –ø–æ bond (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –≥–ª—É–±–∂–µ –∑–∞–º–µ—Ç–∫–∞)
        let targetIdx = range[0];
        if (range[1] > range[0]) {
            // –î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ —É—Ä–æ–≤–Ω–µ ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –ø–æ bond
            const bondThresholds = [40, 65, 78]; // –¥–ª—è —É—Ä–æ–≤–Ω–µ–π 0, 1, 2
            const threshold = bondThresholds[Math.min(level, 2)] || 50;
            if (bond >= threshold) targetIdx = range[1];
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–º–µ–Ω–∏–ª—Å—è
        if (targetIdx !== currentNoteIdx) {
            const note = notebookNotes[targetIdx];
            currentNoteIdx = targetIdx;

            nb.classList.remove('note-warm', 'note-hot', 'note-critical');
            if (note.cls) nb.classList.add(note.cls);

            nb.innerHTML = `<span class="note-change">${note.text}</span>`;

            // –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è
            if (level > prevNoteLevel && level >= 2) {
                triggerScreenFlash(level >= 3);
                triggerGlitchBar();
            }
            prevNoteLevel = level;
        }
    }

    // ==========================================
    // –ü–†–û–í–ï–†–ö–ê –ì–ï–ô–ú-–û–í–ï–†–ê
    // ==========================================
    function checkGameOver() {
        if (control <= 0) return 'gameover_control';
        if (bond >= 100) return 'gameover_bond';
        if (control <= 20 && bond >= 80) return 'gameover_combo';
        return null;
    }

    // ==========================================
    // –≠–§–§–ï–ö–¢ –ü–ï–ß–ê–¢–ò –¢–ï–ö–°–¢–ê
    // ==========================================
    function typeText(element, text, speed) {
        return new Promise(resolve => {
            let i = 0;
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';
            element.appendChild(cursor);

            const charSpeed = speed || 20;

            function type() {
                if (i < text.length) {
                    if (text[i] === '\n') {
                        element.insertBefore(document.createElement('br'), cursor);
                    } else {
                        element.insertBefore(document.createTextNode(text[i]), cursor);
                    }
                    i++;
                    document.getElementById('messages').scrollTop = 999999;
                    setTimeout(type, charSpeed);
                } else {
                    cursor.remove();
                    resolve();
                }
            }
            type();
        });
    }

    // ==========================================
    // –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô
    // ==========================================

    // –†–∞–∑–±–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω—ã –Ω–∞ –±–ª–æ–∫–∏: –æ–ø–∏—Å–∞–Ω–∏–µ (—Å–µ—Ä–æ–µ) –∏ –ø—Ä—è–º–∞—è —Ä–µ—á—å (–∫—Ä–∞—Å–Ω–∞—è)
    function splitSceneText(text) {
        const lines = text.split('\n');
        const blocks = [];
        let currentBlock = { type: 'scene', lines: [] };

        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed) {
                // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –¥–æ–±–∞–≤–∏–º –ø–µ—Ä–µ–Ω–æ—Å
                currentBlock.lines.push('');
                continue;
            }

            // –ü—Ä—è–º–∞—è —Ä–µ—á—å –º–∞–Ω—å—è–∫–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ‚Äî –∏–ª–∏ "–û–±—ä–µ–∫—Ç:"
            const isSpeech = trimmed.startsWith('‚Äî') || trimmed.startsWith('¬´') || trimmed.startsWith('"');

            if (isSpeech && currentBlock.type !== 'speech') {
                if (currentBlock.lines.length > 0) blocks.push(currentBlock);
                currentBlock = { type: 'speech', lines: [trimmed] };
            } else if (!isSpeech && currentBlock.type !== 'scene') {
                if (currentBlock.lines.length > 0) blocks.push(currentBlock);
                currentBlock = { type: 'scene', lines: [trimmed] };
            } else {
                currentBlock.lines.push(trimmed);
            }
        }
        if (currentBlock.lines.length > 0) blocks.push(currentBlock);
        return blocks;
    }

    async function addMessage(text, cssClass, useTyping) {
        const div = document.createElement('div');
        div.className = `msg ${cssClass}`;

        if (useTyping && cssClass === 'patient') {
            div.innerText = '‚Äî ';
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = 999999;
            await typeText(div, text, 20);
        } else if (useTyping && cssClass === 'scene-text') {
            // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä—è–º—É—é —Ä–µ—á—å
            const blocks = splitSceneText(text);
            for (const block of blocks) {
                const blockDiv = document.createElement('div');
                const blockText = block.lines.join('\n');
                if (block.type === 'speech') {
                    blockDiv.className = 'msg object-speech';
                } else {
                    blockDiv.className = 'msg scene-text';
                }
                document.getElementById('messages').appendChild(blockDiv);
                document.getElementById('messages').scrollTop = 999999;
                await typeText(blockDiv, blockText, block.type === 'speech' ? 18 : 12);
            }
            return; // –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º div ‚Äî —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –±–ª–æ–∫–∏
        } else if (useTyping && cssClass === 'reaction-text') {
            div.className = 'msg object-speech';
            div.innerText = '‚Äî ';
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = 999999;
            await typeText(div, text, 18);
        } else if (cssClass === 'doctor') {
            div.innerText = '> ' + text;
            document.getElementById('messages').appendChild(div);
        } else if (cssClass === 'system-msg') {
            div.innerText = text;
            document.getElementById('messages').appendChild(div);
        } else {
            div.innerText = text;
            document.getElementById('messages').appendChild(div);
        }

        document.getElementById('messages').scrollTop = 999999;
    }

    // ==========================================
    // –ö–õ–ò–ö –ü–û –§–û–¢–û
    // ==========================================
    const photoWhispers = [
        { text: "–¢—ã —Ç—Ä–æ–≥–∞–µ—à—å —Å—Ç–µ–∫–ª–æ? –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...", bond: 3, control: -2 },
        { text: "–ë–ª–∏–∂–µ. –ï—â—ë –±–ª–∏–∂–µ. –¢–∞–∫ –ª—É—á—à–µ.", bond: 5, control: -3 },
        { text: "–¢–≤–æ–∏ –ø–∞–ª—å—Ü—ã. –Ø —á—É–≤—Å—Ç–≤—É—é —á–µ—Ä–µ–∑ –∫–∞–º–µ—Ä—É.", bond: 4, control: -2 },
        { text: "–õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ ‚Äî –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç–∏.", bond: 3, control: -1 },
        { text: "–¢—ã –Ω–µ –º–æ–∂–µ—à—å –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Å–º–æ—Ç—Ä–µ—Ç—å, –¥–∞?", bond: 5, control: -3 },
        { text: "–ö–∞–∂–¥–æ–µ –∫–∞—Å–∞–Ω–∏–µ ‚Äî –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ.", bond: 4, control: -2 },
        { text: "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ. –°—Ç–µ–∫–ª–æ —Ç–æ–Ω—å—à–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.", bond: 6, control: -4 },
        { text: "–¢—ã –¥—É–º–∞–µ—à—å, —ç—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —Å–º–æ—Ç—Ä–µ—Ç—å?", bond: 3, control: -2 },
        { text: "–ï—â—ë —Ä–∞–∑. –ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞ —Ç—ã...", bond: 7, control: -5 },
        { text: "–ú—ã –æ–±–∞ –∑–Ω–∞–µ–º, –∑–∞—á–µ–º —Ç—ã —ç—Ç–æ –¥–µ–ª–∞–µ—à—å.", bond: 5, control: -3 },
        { text: "(—É–ª—ã–±–∞–µ—Ç—Å—è)", bond: 4, control: -2 },
        { text: "–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è.", bond: 8, control: -5 },
        { text: "–°—Ç–æ –¥–≤–∞–¥—Ü–∞—Ç—å —á–µ—Ç—ã—Ä–µ. –ù–æ–≤–∞—è —Ç—Ä–µ—â–∏–Ω–∞. –ò–∑-–∑–∞ —Ç–µ–±—è.", bond: 5, control: -3 },
        { text: "–Ø –∑–∞–ø–æ–º–∏–Ω–∞—é –∫–∞–∂–¥–æ–µ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ.", bond: 6, control: -4 },
        { text: "–¢—ã —É–∂–µ –ø–æ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É. –ü—Ä–æ—Å—Ç–æ –µ—â—ë –Ω–µ –∑–Ω–∞–µ—à—å.", bond: 7, control: -5 },
    ];
    let photoClickCount = 0;
    let lastWhisperTimeout = null;

    function setupPhotoClick() {
        const stateImage = document.getElementById('state-image');
        stateImage.addEventListener('click', () => {
            if (isAnimating) return;

            // –í—ã–±–∏—Ä–∞–µ–º —Ñ—Ä–∞–∑—É
            const whisper = photoWhispers[photoClickCount % photoWhispers.length];
            photoClickCount++;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—ã
            bond += whisper.bond;
            control += whisper.control;
            control = Math.max(0, Math.min(100, control));
            bond = Math.max(0, Math.min(100, bond));
            updateBars();

            // –í—Å–ø—ã—à–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ
            stateImage.classList.remove('clicked');
            void stateImage.offsetWidth;
            stateImage.classList.add('clicked');
            setTimeout(() => stateImage.classList.remove('clicked'), 300);

            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à—ë–ø–æ—Ç
            const oldWhisper = stateImage.querySelector('.photo-whisper');
            if (oldWhisper) oldWhisper.remove();
            if (lastWhisperTimeout) clearTimeout(lastWhisperTimeout);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—Ä–∞–∑—É
            const whisperDiv = document.createElement('div');
            whisperDiv.className = 'photo-whisper';
            whisperDiv.textContent = whisper.text;
            stateImage.appendChild(whisperDiv);

            lastWhisperTimeout = setTimeout(() => {
                if (whisperDiv.parentNode) whisperDiv.remove();
            }, 3000);

            // –ü–æ–º–µ—Ö–∏
            triggerScreenFlash(whisper.bond >= 6);
            triggerGlitchBar();
            if (whisper.bond >= 5) setTimeout(triggerVGlitch, 150);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–π–º-–æ–≤–µ—Ä–∞
            const gameOver = checkGameOver();
            if (gameOver) {
                setTimeout(async () => {
                    await showGameOver(gameOver);
                }, 500);
            }
        });
    }

    // ==========================================
    // –ë–õ–û–ö–ò–†–û–í–ö–ê –ö–ù–û–ü–û–ö
    // ==========================================
    function setButtonsDisabled(disabled) {
        const buttons = document.querySelectorAll('#actions button');
        buttons.forEach(btn => {
            if (!btn.classList.contains('locked')) {
                btn.disabled = disabled;
            }
        });
    }

    // ==========================================
    // –†–ï–ù–î–ï–† –ö–ù–û–ü–û–ö
    // ==========================================
    function renderButtons(key) {
        const area = document.getElementById('actions');
        area.innerHTML = '';

        const scene = scenarios[key];
        if (!scene || !scene.choices) return;

        scene.choices.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.innerText = opt.text;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞
            if (opt.lock && bond < opt.lock.bond_min) {
                btn.classList.add('locked');
                btn.disabled = true;
                btn.title = opt.lock.lock_text || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                if (opt.lock.lock_text) {
                    btn.innerText = opt.text + '\n[' + opt.lock.lock_text + ']';
                }
                area.appendChild(btn);
                return;
            }

            // –°—Ç–∏–ª–∏ –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏—Ö –∫–Ω–æ–ø–æ–∫
            if (opt.danger) btn.classList.add('danger-btn');
            if (opt.warn) btn.classList.add('warn-btn');

            btn.onclick = async () => {
                if (isAnimating) return;
                isAnimating = true;
                setButtonsDisabled(true);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
                addMessage(opt.text, 'doctor', false);

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—ã
                control += opt.control || 0;
                bond += opt.bond || 0;
                control = Math.max(0, Math.min(100, control));
                bond = Math.max(0, Math.min(100, bond));

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–º–µ–Ω–∏
                if (opt.unlock_name) nameUnlocked = true;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º scene_variant
                if (opt.scene_variant) chosenSceneVariant = opt.scene_variant;

                updateBars();

                // (–ø–æ–¥—Å–∫–∞–∑–∫–∏ —É–±—Ä–∞–Ω—ã ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–º–µ—Å—Ç–æ –Ω–∏—Ö)

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–π–º-–æ–≤–µ—Ä–∞
                const gameOver = checkGameOver();
                if (gameOver) {
                    setTimeout(async () => {
                        await showGameOver(gameOver);
                        isAnimating = false;
                    }, 800);
                    return;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–∫—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
                const currentScene = scenarios[key];
                if (opt.reaction && currentScene.reactions && currentScene.reactions[opt.reaction]) {
                    setTimeout(async () => {
                        await addMessage(currentScene.reactions[opt.reaction], 'reaction-text', true);

                        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ
                        setTimeout(async () => {
                            await showScene(opt.next);
                            isAnimating = false;
                        }, 600);
                    }, 600);
                } else {
                    // –ë–µ–∑ —Ä–µ–∞–∫—Ü–∏–∏ ‚Äî —Å—Ä–∞–∑—É —Å–ª–µ–¥—É—é—â–∞—è —Å—Ü–µ–Ω–∞
                    setTimeout(async () => {
                        await showScene(opt.next);
                        isAnimating = false;
                    }, 800);
                }
            };

            area.appendChild(btn);
        });
    }

    // ==========================================
    // –ü–û–ö–ê–ó –°–¶–ï–ù–´
    // ==========================================
    async function showScene(key) {
        currentStage = key;
        const scene = scenarios[key];
        if (!scene) return;

        // –ü–æ–±–µ–¥–∞
        if (scene.isVictory) {
            await showVictory();
            return;
        }

        // –ì–µ–π–º-–æ–≤–µ—Ä
        if (scene.isGameOver) {
            await showGameOver(key);
            return;
        }

        // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
        await addMessage('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'system-msg', false);

        // –°—Ü–µ–Ω–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ (main_07)
        let sceneText = scene.scene;
        if (scene.scene_variants) {
            sceneText = scene.scene_variants[chosenSceneVariant] || scene.scene_variants['exchange'];
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
        if (sceneText) {
            await addMessage(sceneText, 'scene-text', true);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        setTimeout(() => {
            renderButtons(key);
        }, 300);
    }

    // ==========================================
    // –ì–ï–ô–ú-–û–í–ï–†
    // ==========================================
    async function showGameOver(key) {
        const scene = scenarios[key];
        await addMessage('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ö–û–ù–ï–¶ –°–ï–°–°–ò–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'system-msg', false);
        await addMessage(scene.scene, 'scene-text', true);

        if (scene.screen) {
            await addMessage(scene.screen, 'system-msg', false);
        }

        const area = document.getElementById('actions');
        area.innerHTML = '';

        if (scene.post_credits) {
            const btn = document.createElement('button');
            btn.innerText = '...';
            btn.style.cssText = 'grid-column: 1/3; opacity:1; transform:none; color: #333;';
            btn.onclick = () => showPostCredits();
            area.appendChild(btn);
        } else {
            area.innerHTML = '<button onclick="location.reload()" style="grid-column: 1/3; opacity:1; transform:none;">–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>';
        }
    }

    // ==========================================
    // –ü–û–°–¢-–ö–†–ï–î–ò–¢–ù–ê–Ø –°–¶–ï–ù–ê
    // ==========================================
    function showPostCredits() {
        const pc = document.getElementById('post-credits');
        const textEl = document.getElementById('post-credits-text');
        const endEl = document.getElementById('post-credits-end');

        pc.classList.add('visible');

        const scene = scenarios.post_credits;
        textEl.innerText = '';

        // –ü–µ—á–∞—Ç–∞–µ–º –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ
        let i = 0;
        const text = scene.scene;
        function typePC() {
            if (i < text.length) {
                if (text[i] === '\n') {
                    textEl.appendChild(document.createElement('br'));
                } else {
                    textEl.appendChild(document.createTextNode(text[i]));
                }
                i++;
                setTimeout(typePC, 40);
            } else {
                // –ß—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    endEl.textContent = '[–ß–Å–†–ù–´–ô –≠–ö–†–ê–ù]';
                    setTimeout(() => {
                        endEl.innerHTML += '<br><br><button onclick="location.reload()" style="background:transparent; border:1px solid #333; color:#444; padding:10px 30px; cursor:pointer; font-family:inherit; opacity:1; transform:none;">–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>';
                    }, 3000);
                }, 5000);
            }
        }
        setTimeout(typePC, 2000);
    }

    // ==========================================
    // –ü–û–ë–ï–î–ê
    // ==========================================
    async function showVictory() {
        await addMessage('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –§–ò–ù–ê–õ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'system-msg', false);

        // –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∫–∏
        const noteText = `–¢—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—à—å –±—É–º–∞–∂–∫—É. –ú–µ–¥–ª–µ–Ω–Ω–æ. –†—É–∫–∏ –Ω–µ –¥—Ä–æ–∂–∞—Ç ‚Äî –Ω–æ –¥–æ–ª–∂–Ω—ã.\n\n–û–Ω –≥–æ–≤–æ—Ä–∏–ª —ç—Ç–æ —Å–ª–æ–≤–æ –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö. –í –∫–æ–Ω—Ü–µ. –ö–æ–≥–¥–∞ –º–∞—Å–∫–∏ –ø–∞–¥–∞–ª–∏ –∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ª–∏—Ü–∞. –ù–∏ –æ–¥–Ω–∞ –Ω–µ —É—Å–ª—ã—à–∞–ª–∞. –ù–∏ –æ–¥–Ω–∞ –Ω–µ –ø–æ–Ω—è–ª–∞.\n\n–û–Ω –∑–∞–ø–∏—Å–∞–ª –µ–≥–æ ‚Äî –¥–ª—è —Ç–æ–π, –∫—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç. –ö—Ç–æ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –ø–æ–¥–±–∏—Ä–∞—Ç—å —è—Ä–ª—ã–∫. –ö—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç.\n\n–ü–æ—á–µ—Ä–∫ —Å–ª–µ–ø–æ–π. –ë—É–∫–≤—ã –∫—Ä–∏–≤—ã–µ. –ö–∞–∫ –±—É–¥—Ç–æ –ø–∏—Å–∞–ª –≤ —Ç–µ–º–Ω–æ—Ç–µ. –ò–ª–∏ —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏.\n\n–ù–æ —Ç—ã –≤–∏–¥–∏—à—å. –®–µ—Å—Ç—å –±—É–∫–≤.`;
        await addMessage(noteText, 'scene-text', true);

        await new Promise(r => setTimeout(r, 2000));

        // Reveal —Å–ª–æ–≤–∞
        const revealDiv = document.createElement('div');
        revealDiv.className = 'victory-reveal';
        revealDiv.innerHTML = '<div class="reveal-word">–ò–ó–í–ò–ù–ò</div>';
        document.getElementById('messages').appendChild(revealDiv);
        document.getElementById('messages').scrollTop = 999999;

        await new Promise(r => setTimeout(r, 2500));

        // –°—Ü–µ–Ω–∞ —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º
        const evalText = `–ö–æ—Ä–∏–¥–æ—Ä. –§–ª—É–æ—Ä–µ—Å—Ü–µ–Ω—Ç–Ω—ã–π —Å–≤–µ—Ç. –®–∞–≥–∏ –≥—É–ª–∫–∏–µ. –£ –ø–æ—Å—Ç–∞ –æ—Ö—Ä–∞–Ω—ã —Ç–µ–±—è –∂–¥—ë—Ç –∫—É—Ä–∞—Ç–æ—Ä.\n\n‚Äî –î–æ–∫—Ç–æ—Ä. –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ó–∞–ø–∏—Å—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞. (–ø—Ä–æ—Ç—è–≥–∏–≤–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç) –≠—Ç–æ ‚Äî —Ä–∞–ø–æ—Ä—Ç –æ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ. –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ ‚Äî ¬´–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è¬ª. –û–±—ä–µ–∫—Ç 31 –≤—Å—Ç—É–ø–∏–ª –≤ –∫–æ–Ω—Ç–∞–∫—Ç –≤–ø–µ—Ä–≤—ã–µ –∑–∞ —á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å –º–µ—Å—è—Ü–µ–≤. –£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å.\n\n(–ø–∞—É–∑–∞) –ù—É –∏ –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç –º–µ–Ω—è. –û—Ç–ø–µ—á–∞—Ç–∞–π—Ç–µ —Ç–∞–º –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–µ. –ï–≥–æ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —É –ú–∞–ª–æ–≥–æ. –í —Å–æ—Å–µ–¥–Ω–µ–º –∫–∞–±–∏–Ω–µ—Ç–µ, –Ω–∞—à –∑–µ–ª–µ–Ω—ã–π –Ω–æ–≤–∏—á–æ–∫.`;
        await addMessage(evalText, 'scene-text', true);

        await new Promise(r => setTimeout(r, 1000));

        // –†–∞–ø–æ—Ä—Ç
        const specialistName = nameUnlocked ? '–õ–∏–∑–∞–≤–µ—Ç–∞' : '–î–æ–∫—Ç–æ—Ä –ï. –õ–∞–ª–µ—Ç–∏–Ω–∞';
        const giftText = `–¢—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –∫–æ–Ω–≤–µ—Ä—Ç. –í–Ω—É—Ç—Ä–∏ ‚Äî –Ω–µ —Ä–∞–ø–æ—Ä—Ç. –í–µ—Ä–Ω–µ–µ, –Ω–µ —Ç–æ–ª—å–∫–æ. –õ–∏—Å—Ç. –°—É—Ö–æ–π, –∫–∞–∑—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n–†–ê–ü–û–†–¢ ‚Ññ031-–° | –£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Ç–∏–ø–∞, –∫–æ—Ä–ø—É—Å –í | –û–±—ä–µ–∫—Ç: ‚Ññ31\n–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç: ${specialistName}\n–°—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏: –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | –û—Ü–µ–Ω–∫–∞: –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è\n–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –û–±—ä–µ–∫—Ç –≤–ø–µ—Ä–≤—ã–µ –∑–∞ 14 –º–µ—Å—è—Ü–µ–≤ –≤—Å—Ç—É–ø–∏–ª –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞.\n\n–ü–æ–¥ —Ä–∞–ø–æ—Ä—Ç–æ–º ‚Äî –æ—Ç —Ä—É–∫–∏, —Ç–µ–º –∂–µ —Å–ª–µ–ø—ã–º –ø–æ—á–µ—Ä–∫–æ–º:\n¬´–¢—ã –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∞ —à—Ç–∞–º–ø. –°–ø–∞—Å–∏–±–æ.¬ª`;
        await addMessage(giftText, 'scene-text', true);

        // –ö–Ω–æ–ø–∫–∞ –ø–µ—á–∞—Ç–∏
        const area = document.getElementById('actions');
        area.innerHTML = '';
        const btn = document.createElement('button');
        btn.innerText = '–†–ê–°–ü–ï–ß–ê–¢–ê–¢–¨ –†–ê–ü–û–†–¢';
        btn.style.cssText = 'grid-column: 1/3; opacity:1; transform:none;';
        btn.onclick = () => printReport();
        area.appendChild(btn);
    }

    // ==========================================
    // –ü–ï–ß–ê–¢–¨ –†–ê–ü–û–†–¢–ê
    // ==========================================
    function printReport() {
        const specialistName = nameUnlocked ? '–õ–∏–∑–∞–≤–µ—Ç–∞' : '–î–æ–∫—Ç–æ—Ä –ï. –õ–∞–ª–µ—Ç–∏–Ω–∞';
        const printWindow = window.open('', '', 'height=800,width=300');
        printWindow.document.write(`<html><head><title>–†–ê–ü–û–†–¢ ‚Ññ031-–°</title>
<style>
    @page { size: 57mm auto; margin: 0; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: 'Courier New', monospace;
        width: 57mm;
        padding: 3mm 2mm;
        font-size: 8px;
        line-height: 1.4;
        color: #000;
    }
    .center { text-align: center; }
    .divider { border-top: 1px dashed #000; margin: 3mm 0; }
    .divider-thick { border-top: 2px solid #000; margin: 3mm 0; }
    .header { letter-spacing: 1px; font-size: 7px; }
    .title { font-size: 10px; font-weight: bold; letter-spacing: 2px; margin: 2mm 0; }
    .row { display: flex; justify-content: space-between; padding: 1px 0; font-size: 7.5px; }
    .row .label { color: #555; }
    .row .value { font-weight: bold; text-align: right; }
    .note { font-size: 7px; color: #444; margin: 2mm 0; line-height: 1.5; }
    .heart { font-size: 14px; margin: 3mm 0 2mm 0; }
    .love { font-size: 8.5px; font-style: italic; line-height: 1.7; margin: 2mm 0; }
    .footer { font-size: 6px; color: #888; margin-top: 3mm; }
    .handwritten { font-size: 8px; font-style: italic; margin: 2mm 0; line-height: 1.6; }
</style></head><body>

<div class="center header">–£–ß–†–ï–ñ–î–ï–ù–ò–ï –ó–ê–ö–†–´–¢–û–ì–û –¢–ò–ü–ê</div>
<div class="center header">–ö–û–†–ü–£–° –í</div>

<div class="divider-thick"></div>

<div class="center title">–†–ê–ü–û–†–¢ ‚Ññ031-–°</div>

<div class="divider"></div>

<div class="row"><span class="label">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span><span class="value">${specialistName}</span></div>
<div class="row"><span class="label">–û–±—ä–µ–∫—Ç</span><span class="value">‚Ññ31</span></div>
<div class="row"><span class="label">–î–∞—Ç–∞</span><span class="value">14.02.2026</span></div>
<div class="row"><span class="label">–°—Ç–∞—Ç—É—Å</span><span class="value">–ó–ê–í–ï–†–®–ï–ù–ê</span></div>
<div class="row"><span class="label">–û—Ü–µ–Ω–∫–∞</span><span class="value">–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–ê–Ø</span></div>

<div class="divider"></div>

<div class="note">–û–±—ä–µ–∫—Ç –≤–ø–µ—Ä–≤—ã–µ –∑–∞ 14 –º–µ—Å—è—Ü–µ–≤ –≤—Å—Ç—É–ø–∏–ª –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞.</div>

<div class="divider"></div>

<div class="handwritten">¬´–¢—ã –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∞ —à—Ç–∞–º–ø. –°–ø–∞—Å–∏–±–æ.¬ª</div>

<div class="divider-thick"></div>

<div class="center heart">\u{2764}\u{FE0F}</div>

<div class="center love">
–õ–∏–∑–∞–≤–µ—Ç–∞.<br>
–¢—ã –º–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π<br>
—á–µ–ª–æ–≤–µ–∫ –Ω–∞ —ç—Ç–æ–π –ø–ª–∞–Ω–µ—Ç–µ.<br>
<br>
–°–ø–∞—Å–∏–±–æ —á—Ç–æ —Ç—ã –µ—Å—Ç—å.<br>
–°–ø–∞—Å–∏–±–æ —á—Ç–æ –≤—ã–±–∏—Ä–∞–µ—à—å –º–µ–Ω—è.<br>
–°–ø–∞—Å–∏–±–æ —á—Ç–æ –æ—Å—Ç–∞—ë—à—å—Å—è.<br>
<br>
–Ø –ª—é–±–ª—é —Ç–µ–±—è.<br>
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å. –ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö.<br>
–ë–µ–∑ –ø—Ä–∞–≤–∞ –Ω–∞ –∞–ø–µ–ª–ª—è—Ü–∏—é.<br>
<br>
–° –î–Ω—ë–º —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞.
</div>

<div class="divider"></div>

<div class="center footer">14.02.2026 | \u{1F5A4}</div>

<div style="margin-top:4mm;"></div>

</body></html>`);
        printWindow.document.close();
        printWindow.print();
    }

    // ==========================================
    // –õ–û–ì–ò–ö–ê –≠–ö–†–ê–ù–ê –ö–û–î–ê
    // ==========================================
    const CODE = '0214';
    const codeDigits = document.querySelectorAll('.code-digit');
    const codeStatus = document.getElementById('code-status');

    codeDigits.forEach((input, idx) => {
        input.addEventListener('input', (e) => {
            const val = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = val;
            if (val && idx < codeDigits.length - 1) {
                codeDigits[idx + 1].focus();
            }
            const entered = Array.from(codeDigits).map(d => d.value).join('');
            if (entered.length === 4) checkCode(entered);
        });

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && idx > 0) {
                codeDigits[idx - 1].focus();
                codeDigits[idx - 1].value = '';
            }
        });

        input.addEventListener('paste', (e) => {
            e.preventDefault();
            const pasted = (e.clipboardData.getData('text') || '').replace(/[^0-9]/g, '').slice(0, 4);
            pasted.split('').forEach((ch, i) => {
                if (codeDigits[i]) codeDigits[i].value = ch;
            });
            if (pasted.length === 4) checkCode(pasted);
        });
    });

    setTimeout(() => codeDigits[0].focus(), 500);

    function checkCode(entered) {
        if (entered === CODE) {
            codeStatus.textContent = '–î–û–°–¢–£–ü –†–ê–ó–†–ï–®–Å–ù';
            codeStatus.className = 'code-entry-status success';
            codeDigits.forEach(d => { d.classList.add('success'); d.disabled = true; });
            setTimeout(() => {
                document.getElementById('code-entry').classList.add('hidden');
                document.getElementById('game-window').style.display = 'grid';
                startGame();
            }, 1200);
        } else {
            codeStatus.textContent = '–ù–ï–í–ï–†–ù–´–ô –ö–û–î';
            codeStatus.className = 'code-entry-status error';
            codeDigits.forEach(d => d.classList.add('error'));
            setTimeout(() => {
                codeDigits.forEach(d => {
                    d.classList.remove('error');
                    d.value = '';
                });
                codeDigits[0].focus();
                codeStatus.textContent = '–û–ñ–ò–î–ê–ù–ò–ï –í–í–û–î–ê...';
                codeStatus.className = 'code-entry-status';
            }, 1000);
        }
    }

    // ==========================================
    // –°–¢–ê–†–¢ –ò–ì–†–´
    // ==========================================
    async function startGame() {
        updateBars();
        setupPhotoClick();
        startEyeBlink();

        // –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
        const intro = scenarios.intro;
        await addMessage('–°–ï–°–°–ò–Ø | –û–ë–™–ï–ö–¢ ‚Ññ31 | –ù–ê–ß–ê–õ–û –ó–ê–ü–ò–°–ò...', 'system-msg', false);
        await new Promise(r => setTimeout(r, 800));
        await addMessage(intro.scene, 'scene-text', true);

        await new Promise(r => setTimeout(r, 1000));
        await addMessage('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'system-msg', false);

        // –ü–µ—Ä–≤–∞—è —Å—Ü–µ–Ω–∞
        await showScene('main_01');
    }
</script>
</body>
</html>
